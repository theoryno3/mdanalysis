

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MDAnalysis.coordinates.PDB &mdash; MDAnalysis 0.10.0-dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.10.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.10.0-dev documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
    <link rel="top" title="MDAnalysis 0.10.0-dev documentation" href="../../../index.html" />
    <link rel="up" title="MDAnalysis" href="../../MDAnalysis.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MDAnalysis 0.10.0-dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../MDAnalysis.html" accesskey="U">MDAnalysis</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mdanalysis-logo-200x150.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MDAnalysis.coordinates.PDB</h1><div class="highlight"><pre>
<span class="c"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4 fileencoding=utf-8</span>
<span class="c">#</span>
<span class="c"># MDAnalysis --- http://www.MDAnalysis.org</span>
<span class="c"># Copyright (c) 2006-2015 Naveen Michaud-Agrawal, Elizabeth J. Denning, Oliver Beckstein</span>
<span class="c"># and contributors (see AUTHORS for the full list)</span>
<span class="c">#</span>
<span class="c"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c">#</span>
<span class="c"># Please cite your use of MDAnalysis in published work:</span>
<span class="c">#</span>
<span class="c"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c">#</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PDB structure files in MDAnalysis --- :mod:`MDAnalysis.coordinates.PDB`</span>
<span class="sd">========================================================================</span>

<span class="sd">MDAnalysis reads coordinates from PDB files and additional optional</span>
<span class="sd">data such as B-factors. It is also possible to substitute a PDB file</span>
<span class="sd">instead of PSF file in order to define the list of atoms (but no</span>
<span class="sd">connectivity information will be  available in this case).</span>

<span class="sd">PDB files contain both coordinate and atom information. It is also possible to</span>
<span class="sd">write trajectories as multi-frame (or multi-model) PDB files. This is not very</span>
<span class="sd">space efficient but is sometimes the lowest common denominator for exchanging</span>
<span class="sd">trajectories. Single frame and multi-frame PDB files are automatically</span>
<span class="sd">recognized; the only difference is thath the single-frame PDB is represented as</span>
<span class="sd">a trajectory with only one frame.</span>

<span class="sd">In order to write a selection to a PDB file one typically uses the</span>
<span class="sd">:meth:`MDAnalysis.core.AtomGroup.AtomGroup.write` method of the selection::</span>

<span class="sd">  calphas = universe.selectAtoms(&quot;name CA&quot;)</span>
<span class="sd">  calphas.write(&quot;calpha_only.pdb&quot;)</span>

<span class="sd">This uses the coordinates from the current timestep of the trajectory.</span>

<span class="sd">In order to write a PDB trajectory one needs to first obtain a multi-frame</span>
<span class="sd">writer (keyword *multiframe* = ``True``) and then iterate through the</span>
<span class="sd">trajectory, while writing each frame::</span>

<span class="sd">  calphas = universe.selectAtoms(&quot;name CA&quot;)</span>
<span class="sd">  W = MDAnalysis.Writer(&quot;calpha_traj.pdb&quot;, multiframe=True)</span>
<span class="sd">  for ts in u.trajectory:</span>
<span class="sd">      W.write(calphas)</span>
<span class="sd">  W.close()</span>

<span class="sd">It is important to *always close the trajectory* when done because only at this</span>
<span class="sd">step is the final END_ record written, which is required by the `PDB</span>
<span class="sd">standard`_.</span>


<span class="sd">Implementations</span>
<span class="sd">---------------</span>

<span class="sd">Two different implementations of PDB I/O are available: the &quot;:ref:`permissive&lt;permissive&gt;`&quot;</span>
<span class="sd">and the &quot;:ref:`strict&lt;strict&gt;`&quot; Reader/Writers. The default are the &quot;permissive&quot; ones</span>
<span class="sd">but this can be changed by setting the flag &quot;permissive_pdb_reader&quot; in</span>
<span class="sd">:data:`MDAnalysis.core.flags` (see :ref:`flags-label`) to ``False``::</span>

<span class="sd">   MDAnalysis.core.flags[&quot;permissive_pdb_reader&quot;] = False</span>

<span class="sd">The *default for MDAnalysis* is to use the</span>
<span class="sd">&quot;:ref:`permissive&lt;permissive&gt;`&quot; :class:`PrimitivePDBReader` and</span>
<span class="sd">:class:`PrimitivePDBWriter`, corresponding to ::</span>

<span class="sd">   MDAnalysis.core.flags[&quot;permissive_pdb_reader&quot;] = True</span>

<span class="sd">On a case-by-case basis one kind of reader can be selected with the</span>
<span class="sd">*permissive* keyword to :class:`~MDAnalysis.core.AtomGroup.Universe`, e.g. ::</span>

<span class="sd">  u = MDAnalysis.Universe(PDB, permissive=False)</span>

<span class="sd">would select :class:`PDBReader` instead of the default</span>
<span class="sd">:class:`PrimitivePDBReader`.</span>

<span class="sd">.. _permissive:</span>

<span class="sd">Simple (permissive) PDB Reader and Writer</span>
<span class="sd">-----------------------------------------</span>

<span class="sd">A pure-Python implementation for PDB files commonly encountered in MD</span>
<span class="sd">simulations comes under the names :class:`PrimitivePDBReader` and</span>
<span class="sd">:class:`PrimitivePDBWriter`. It only implements a subset of the `PDB standard`_</span>
<span class="sd">(for instance, it does not deal with insertion codes) and also allows some</span>
<span class="sd">typical enhancements such as 4-letter resids (introduced by CHARMM/NAMD). The</span>
<span class="sd">&quot;primitive PDB Reader/Writer&quot; are the *default* in MDAnalysis (equivalent to</span>
<span class="sd">supplying the *permissive* = ``True`` keyword to</span>
<span class="sd">:class:`~MDAnalysis.core.AtomGroup.Universe`).</span>

<span class="sd">The :class:`PrimitivePDBReader` can read multi-frame PDB files and represents</span>
<span class="sd">them as a trajectory. The :class:`PrimitivePDBWriter` can write single and</span>
<span class="sd">multi-frame PDB files as specified by the *multiframe* keyword. By default, it</span>
<span class="sd">writes single frames. On the other hand, the :class:`MultiPDBWriter` is set up</span>
<span class="sd">to write a PDB trajectory by default (equivalent to using *multiframe* =</span>
<span class="sd">``True``).</span>

<span class="sd">Examples</span>
<span class="sd">~~~~~~~~</span>

<span class="sd">In order to write a **multi-frame PDB trajectory** from a universe *u* one can</span>
<span class="sd">do the following::</span>

<span class="sd">  pdb = MDAnalysis.Writer(&quot;all.pdb&quot;, multiframe=True)</span>
<span class="sd">  for ts in u.trajectory:</span>
<span class="sd">      pdb.write(u)</span>
<span class="sd">  pdb.close()</span>

<span class="sd">Similarly, writing only a protein::</span>

<span class="sd">  pdb = MDAnalysis.Writer(&quot;protein.pdb&quot;, multiframe=True)</span>
<span class="sd">  protein = u.selectAtoms(&quot;protein&quot;)</span>
<span class="sd">  for ts in u.trajectory:</span>
<span class="sd">      pdb.write(protein)</span>
<span class="sd">  pdb.close()</span>

<span class="sd">A single frame can be written with the</span>
<span class="sd">:meth:`~MDAnalysis.core.AtomGroup.AtomGroup.write` method of any</span>
<span class="sd">:class:`~MDAnalysis.core.AtomGroup.AtomGroup`::</span>

<span class="sd">   protein = u.selectAtoms(&quot;protein&quot;)</span>
<span class="sd">   protein.write(&quot;protein.pdb&quot;)</span>

<span class="sd">Alternatively, get the single frame writer and supply the</span>
<span class="sd">:class:`~MDAnalysis.core.AtomGroup.AtomGroup`::</span>

<span class="sd">  pdb = MDAnalysis.Writer(&quot;protein.pdb&quot;)</span>
<span class="sd">  protein = u.selectAtoms(&quot;protein&quot;)</span>
<span class="sd">  pdb.write(protein)</span>
<span class="sd">  pdb.close()</span>


<span class="sd">Classes</span>
<span class="sd">~~~~~~~</span>

<span class="sd">.. autoclass:: PrimitivePDBReader</span>
<span class="sd">   :members:</span>

<span class="sd">.. autoclass:: PrimitivePDBWriter</span>
<span class="sd">   :members:</span>

<span class="sd">   .. automethod:: _check_pdb_coordinates</span>
<span class="sd">   .. automethod:: _write_pdb_bonds</span>
<span class="sd">   .. automethod:: _update_frame</span>
<span class="sd">   .. automethod:: _write_timestep</span>

<span class="sd">.. autoclass:: MultiPDBWriter</span>
<span class="sd">   :members:</span>

<span class="sd">.. _strict:</span>

<span class="sd">Biopython (strict) PDB Reader and Writer</span>
<span class="sd">----------------------------------------</span>

<span class="sd">The :mod:`PDB` module can make use of Biopython&#39;s :mod:`Bio.PDB`</span>
<span class="sd">[Hamelryck2003]_ but replaces the standard PDB file parser with one that uses</span>
<span class="sd">the :class:`MDAnalysis.coordinates.pdb.extensions.SloppyStructureBuilder` to</span>
<span class="sd">cope with very large pdb files as commonly encountered in MD simulations. The</span>
<span class="sd">Biopython-based :class:`PDBReader` has the advantage that it implements the</span>
<span class="sd">`PDB standard`_ rigorously but this comes at the cost of flexibility and</span>
<span class="sd">performance. It is also difficult to write out selections using this</span>
<span class="sd">implementation (:class:`PDBWriter`) and multi frame PDB files are not</span>
<span class="sd">implemented. The Biopython Reader/Writer can be selected when loading data into</span>
<span class="sd">a :class:`~MDAnalysis.core.AtomGroup.Universe` by providing the keyword</span>
<span class="sd">*permissive* = ``False``.</span>

<span class="sd">The Biopython PDB parser :class:`Bio.PDB.PDBParser` is fairly strict and even</span>
<span class="sd">in its own permissive mode (which MDAnalysis employs) typically warns about</span>
<span class="sd">missing element names with a</span>
<span class="sd">:exc:`Bio.PDB.PDBExceptions.PDBConstructionWarning` . Such warnings, however,</span>
<span class="sd">are generally harmless and therefore are filtered (and ignored) by MDAnalysis</span>
<span class="sd">with the help of :func:`warnings.filterwarnings`.</span>


<span class="sd">Classes</span>
<span class="sd">~~~~~~~</span>

<span class="sd">.. autoclass:: PDBReader</span>
<span class="sd">   :members:</span>

<span class="sd">.. autoclass:: PDBWriter</span>
<span class="sd">   :members:</span>

<span class="sd">References</span>
<span class="sd">----------</span>

<span class="sd">.. [Hamelryck2003]  Hamelryck, T., Manderick, B. (2003) PDB parser and structure class</span>
<span class="sd">                    implemented in Python. Bioinformatics, 19, 2308-2310. http://biopython.org</span>

<span class="sd">.. _PDB standard: http://www.wwpdb.org/documentation/format32/v3.2.html</span>
<span class="sd">.. _END: http://www.wwpdb.org/documentation/format32/sect11.html#END</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># BioPython is overkill but potentially extensible (altLoc etc)</span>
    <span class="kn">import</span> <span class="nn">Bio.PDB</span>
    <span class="kn">import</span> <span class="nn">pdb.extensions</span>
    <span class="c"># disable PDBConstructionWarning from picky builder</span>
    <span class="kn">import</span> <span class="nn">warnings</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">Bio</span><span class="o">.</span><span class="n">PDB</span><span class="o">.</span><span class="n">PDBExceptions</span><span class="o">.</span><span class="n">PDBConstructionWarning</span><span class="p">,</span>
                            <span class="n">message</span><span class="o">=</span><span class="s">&quot;Could not assign element|Used element .* for Atom&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c"># TODO: fall back to PrimitivePDBReader</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;No full-feature PDB I/O functionality. Install biopython.&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">MDAnalysis.core</span>
<span class="kn">import</span> <span class="nn">MDAnalysis.core.util</span> <span class="kn">as</span> <span class="nn">util</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.topology.core</span> <span class="kn">import</span> <span class="n">guess_atom_element</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.core.AtomGroup</span> <span class="kn">import</span> <span class="n">Universe</span>
<span class="kn">from</span> <span class="nn">MDAnalysis</span> <span class="kn">import</span> <span class="n">NoDataError</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;MDAnalysis.coordinates.PBD&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="PDBReader"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBReader">[docs]</a><span class="k">class</span> <span class="nc">PDBReader</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">SingleFrameReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read a pdb file into a BioPython pdb structure.</span>

<span class="sd">    The coordinates are also supplied as one numpy array and wrapped</span>
<span class="sd">    into a Timestep object; attributes are set so that the PDBReader</span>
<span class="sd">    object superficially resembles the DCDReader object.</span>

<span class="sd">    .. Note:: The Biopython.PDB reader does not parse the ``CRYST1``</span>
<span class="sd">              record and hence the unitcell dimensions are not set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;PDB&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;length&#39;</span><span class="p">:</span> <span class="s">&#39;Angstrom&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_read_first_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pdb_id</span> <span class="o">=</span> <span class="s">&quot;0UNK&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">pdb_id</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">coord</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numatoms</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># parse B field for fixed atoms?</span>
        <span class="c">#self.ts._unitcell[:] = ??? , from CRYST1? --- not implemented in Biopython.PDB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Timestep</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">del</span> <span class="n">pos</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>  <span class="c"># in-place !</span>

<div class="viewcode-block" id="PDBReader.get_bfactors"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBReader.get_bfactors">[docs]</a>    <span class="k">def</span> <span class="nf">get_bfactors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an array of bfactors (tempFactor) in atom order.&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;get_bfactors() will be removed in MDAnalysis 0.8; &quot;</span>
                      <span class="s">&quot;use AtomGroup.bfactors [which will become AtomGroup.bfactors()]&quot;</span><span class="p">,</span>
                      <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_bfactor</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">()])</span>
</div>
<div class="viewcode-block" id="PDBReader.Writer"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBReader.Writer">[docs]</a>    <span class="k">def</span> <span class="nf">Writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a strict PDBWriter for *filename*.</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          *filename*</span>
<span class="sd">              filename of the output PDB file</span>

<span class="sd">        :Returns: :class:`PDBWriter`</span>

<span class="sd">        .. Note::</span>

<span class="sd">           This :class:`PDBWriter` &#39;s :meth:`~PDBWriter.write` method</span>
<span class="sd">           always requires a :class:`base.Timestep` as an argument (it is</span>
<span class="sd">           not optional anymore when the Writer is obtained through</span>
<span class="sd">           this method of :class:`PDBReader` .)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This is messy; we cannot get a universe from the Reader, which would be</span>
        <span class="c"># also needed to be fed to the PDBWriter (which is a total mess...).</span>
        <span class="c"># Hence we ignore the problem and document it in the doc string... --- the</span>
        <span class="c"># limitation is simply that PDBWriter.write() must always be called with an argument.</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;BioPDBstructure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span>  <span class="c"># make sure that this Writer is</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;universe&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>  <span class="c"># always linked to this reader, don&#39;t bother with Universe</span>
        <span class="k">return</span> <span class="n">PDBWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PDBWriter"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter">[docs]</a><span class="k">class</span> <span class="nc">PDBWriter</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Writer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write out the current time step as a pdb file.</span>

<span class="sd">    This is not cleanly implemented at the moment. One must supply a</span>
<span class="sd">    universe, even though this is nominally an optional argument. The</span>
<span class="sd">    class behaves slightly differently depending on if the structure</span>
<span class="sd">    was loaded from a PDB (then the full-fledged :mod:`Bio.PDB` writer is</span>
<span class="sd">    used) or if this is really only an atom selection (then a less</span>
<span class="sd">    sophistiocated writer is employed).</span>

<span class="sd">    .. Note::</span>

<span class="sd">       The standard PDBWriter can only write the *whole system*.  In</span>
<span class="sd">       order to write a selection, use the :class:`PrimitivePDBWriter` ,</span>
<span class="sd">       which happens automatically when the</span>
<span class="sd">       :meth:`~MDAnalysis.core.AtomGroup.AtomGroup.write` method of a</span>
<span class="sd">       :class:`~MDAnalysis.core.AtomGroup.AtomGroup` instance is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;PDB&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;length&#39;</span><span class="p">:</span> <span class="s">&#39;Angstrom&#39;</span><span class="p">}</span>

    <span class="c"># PDBWriter is a bit more complicated than the DCDWriter in the</span>
    <span class="c"># sense that a DCD frame only contains coordinate information. The</span>
    <span class="c"># PDB contains atom data as well and hence it MUST access the</span>
    <span class="c"># universe. In order to present a unified (and backwards</span>
    <span class="c"># compatible) interface we must keep the universe argument an</span>
    <span class="c"># optional keyword argument even though it really is required.</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbfilename</span><span class="p">,</span> <span class="n">universe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;pdbwriter = PDBWriter(&lt;pdbfilename&gt;,universe=universe,**kwargs)</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          pdbfilename     filename; if multi=True, embed a %%d formatstring</span>
<span class="sd">                          so that write_next_timestep() can insert the frame number</span>

<span class="sd">          universe        supply a universe [really REQUIRED; optional only for compatibility]</span>

<span class="sd">          multi           False: write a single structure to a single pdb</span>
<span class="sd">                          True: write all frames to multiple pdb files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">Bio.PDB.Structure</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="o">=</span> <span class="n">universe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;BioPDBstructure&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>  <span class="c"># hack for PDBReader.Writer()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">pdb</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">pdbfilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi</span> <span class="o">=</span> <span class="n">multi</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Sorry, multi=True does not work yet.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span><span class="p">,</span> <span class="n">Bio</span><span class="o">.</span><span class="n">PDB</span><span class="o">.</span><span class="n">Structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;If defined, PDBstructure must be a Bio.PDB.Structure.Structure, eg &#39;</span>
                            <span class="s">&#39;Universe.trajectory.pdb.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

<div class="viewcode-block" id="PDBWriter.write"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PDBWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write timestep as a pdb file.</span>

<span class="sd">        If ts=None then we try to get the current one from the universe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;PDBWriter: Not writing frame as neither Timestep nor Universe supplied.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c"># primitive PDB writing (ignores timestep argument)</span>
            <span class="n">ppw</span> <span class="o">=</span> <span class="n">PrimitivePDBWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">ppw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">selectAtoms</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">))</span>
            <span class="n">ppw</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># full fledged PDB writer</span>
            <span class="c"># Let&#39;s cheat and use universe.pdb.pdb: modify coordinates</span>
            <span class="c"># and save...</span>
            <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;PDBWriter: Not writing frame as neither universe nor timestep supplied.&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s">&#39;_pos&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;The PDBWriter can only process a Timestep as optional argument, not &quot;</span>
                                <span class="s">&quot;e.g. a selection. Use the PrimitivePDBWriter instead and see the docs.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(),</span> <span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">set_coord</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">SloppyPDBIO</span><span class="p">()</span>
            <span class="n">io</span><span class="o">.</span><span class="n">set_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PDBstructure</span><span class="p">)</span>
            <span class="n">io</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PrimitivePDBReader"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBReader">[docs]</a><span class="k">class</span> <span class="nc">PrimitivePDBReader</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Reader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDBReader that reads a PDB-formatted file, no frills.</span>

<span class="sd">    The following PDB records are parsed (see `PDB coordinate section`_ for details):</span>
<span class="sd">     - CRYST1 for unitcell A,B,C, alpha,beta,gamma</span>
<span class="sd">     - ATOM or HETATM for serial,name,resName,chainID,resSeq,x,y,z,occupancy,tempFactor</span>
<span class="sd">     - HEADER, TITLE, COMPND</span>
<span class="sd">     - all other lines are ignored</span>

<span class="sd">    Reads multi-`MODEL`_ PDB files as trajectories.</span>

<span class="sd">    .. _PDB coordinate section: http://www.wwpdb.org/documentation/format32/sect9.html</span>
<span class="sd">    .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>

<span class="sd">    =============  ============  ===========  =============================================</span>
<span class="sd">    COLUMNS        DATA  TYPE    FIELD        DEFINITION</span>
<span class="sd">    =============  ============  ===========  =============================================</span>
<span class="sd">    1 -  6         Record name   &quot;CRYST1&quot;</span>
<span class="sd">    7 - 15         Real(9.3)     a              a (Angstroms).</span>
<span class="sd">    16 - 24        Real(9.3)     b              b (Angstroms).</span>
<span class="sd">    25 - 33        Real(9.3)     c              c (Angstroms).</span>
<span class="sd">    34 - 40        Real(7.2)     alpha          alpha (degrees).</span>
<span class="sd">    41 - 47        Real(7.2)     beta           beta (degrees).</span>
<span class="sd">    48 - 54        Real(7.2)     gamma          gamma (degrees).</span>

<span class="sd">    1 -  6         Record name   &quot;ATOM  &quot;</span>
<span class="sd">    7 - 11         Integer       serial       Atom  serial number.</span>
<span class="sd">    13 - 16        Atom          name         Atom name.</span>
<span class="sd">    17             Character     altLoc       Alternate location indicator. IGNORED</span>
<span class="sd">    18 - 21        Residue name  resName      Residue name.</span>
<span class="sd">    22             Character     chainID      Chain identifier.</span>
<span class="sd">    23 - 26        Integer       resSeq       Residue sequence number.</span>
<span class="sd">    27             AChar         iCode        Code for insertion of residues. IGNORED</span>
<span class="sd">    31 - 38        Real(8.3)     x            Orthogonal coordinates for X in Angstroms.</span>
<span class="sd">    39 - 46        Real(8.3)     y            Orthogonal coordinates for Y in Angstroms.</span>
<span class="sd">    47 - 54        Real(8.3)     z            Orthogonal coordinates for Z in Angstroms.</span>
<span class="sd">    55 - 60        Real(6.2)     occupancy    Occupancy.</span>
<span class="sd">    61 - 66        Real(6.2)     tempFactor   Temperature  factor.</span>
<span class="sd">    67 - 76        String        segID        (unofficial CHARMM extension ?)</span>
<span class="sd">    77 - 78        LString(2)    element      Element symbol, right-justified. IGNORED</span>
<span class="sd">    79 - 80        LString(2)    charge       Charge  on the atom. IGNORED</span>
<span class="sd">    =============  ============  ===========  =============================================</span>


<span class="sd">    .. SeeAlso:: :class:`PrimitivePDBWriter`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;PDB&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;length&#39;</span><span class="p">:</span> <span class="s">&#39;Angstrom&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">convert_units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read coordinates from *filename*.</span>

<span class="sd">        *filename* can be a gzipped or bzip2ed compressed PDB file.</span>

<span class="sd">        If the pdb file contains multiple MODEL records then it is</span>
<span class="sd">        read as a trajectory where the MODEL numbers correspond to</span>
<span class="sd">        frame numbers. Therefore, the MODEL numbers must be a sequence</span>
<span class="sd">        of integers (typically starting at 1 or 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">convert_units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">convert_units</span> <span class="o">=</span> <span class="n">MDAnalysis</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s">&#39;convert_lengths&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span> <span class="o">=</span> <span class="n">convert_units</span>  <span class="c"># convert length and time to base units</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_numatoms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;numatoms&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;PrimitivePDBReader requires the numatoms keyword&quot;</span><span class="p">)</span>

        <span class="c"># = NOTE to clear up confusion over 0-based vs 1-based frame numbering =</span>
        <span class="c"># self.frame is 1-based for this Reader, which matches the behavior of</span>
        <span class="c"># the MODEL record in a typical multi-model PDB file.  If the MODEL</span>
        <span class="c"># record is 0-based, this is accounted for by __init__.</span>
        <span class="c"># self._read_frame assumes that it is passed a 0-based frame number, so</span>
        <span class="c"># that it functions as expected when slicing is used.</span>

        <span class="c"># If MODEL number in the PDB file is 0-based, then this model_offset</span>
        <span class="c"># will be set to 1 by __init__.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;model_offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">compound</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remarks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Timestep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_numatoms</span><span class="p">)</span>
        
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># atom position for filling coordinates array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">openany</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdbfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c"># Remove extra spaces</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># Skip line if empty</span>
                    <span class="k">continue</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">record</span> <span class="o">==</span> <span class="s">&#39;END&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s">&#39;CRYST1&#39;</span><span class="p">:</span>
                    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">24</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">33</span><span class="p">]])</span>
                    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">40</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s">&#39;HEADER&#39;</span><span class="p">:</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s">&#39;COMPND&#39;</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">compound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s">&#39;REMARK&#39;</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">remarks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">record</span> <span class="o">==</span> <span class="s">&#39;MODEL&#39;</span><span class="p">:</span>
                    <span class="n">frames</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>  <span class="c"># 1-based indexing</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ATOM  &#39;</span><span class="p">,</span> <span class="s">&#39;HETATM&#39;</span><span class="p">):</span>
                    <span class="c"># skip atom/hetatm for frames other than the first</span>
                    <span class="c"># they will be read in when next() is called</span>
                    <span class="c"># on the trajectory reader</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">38</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">46</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">54</span><span class="p">]])</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">occupancy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">54</span><span class="p">:</span><span class="mi">60</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occupancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compound</span> <span class="o">=</span> <span class="n">compound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span> <span class="o">=</span> <span class="n">remarks</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numatoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Read an incorrect number of atoms</span><span class="se">\n</span><span class="s">&quot;</span>
                             <span class="s">&quot;Expected {expected} got {actual}&quot;</span>
                             <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_numatoms</span><span class="p">,</span> <span class="n">actual</span><span class="o">=</span><span class="n">pos</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numatoms</span> <span class="o">=</span> <span class="n">pos</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># 1-based frame number as starting frame</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>  <span class="c"># in-place !</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>  <span class="c"># in-place ! (only lengths)</span>

        <span class="c"># No &#39;MODEL&#39; entries</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">frames</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numframes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="k">if</span> <span class="n">frames</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_timestep</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="PrimitivePDBReader.get_occupancy"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBReader.get_occupancy">[docs]</a>    <span class="k">def</span> <span class="nf">get_occupancy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an array of occupancies in atom order.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_occupancy</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PrimitivePDBReader.Writer"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBReader.Writer">[docs]</a>    <span class="k">def</span> <span class="nf">Writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a permissive (simple) PDBWriter for *filename*.</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          *filename*</span>
<span class="sd">              filename of the output PDB file</span>

<span class="sd">        :Returns: :class:`PrimitivePDBWriter`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;multiframe&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numframes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PrimitivePDBWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numframes</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_frame</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">StopIteration</span>

    <span class="k">def</span> <span class="nf">_read_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: cleanup _read_frame() to use a &quot;free&quot; Timestep</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;PrimitivePDBReader cannot assign to a timestep&quot;</span><span class="p">)</span>
        <span class="c"># frame is 1-based. Normally would add 1 to frame before calling</span>
        <span class="c"># self._read_frame to retrieve the subsequent ts. But self._read_frame</span>
        <span class="c"># assumes it is being passed a 0-based frame, and adjusts.</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span> <span class="o">!=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;frame must be a integer&quot;</span><span class="p">)</span>
        <span class="c"># Assume _read_frame is passed a 0-based frame number. Convert this to</span>
        <span class="c"># 1-based.</span>
        <span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># single frame file, we already have the timestep</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>

        <span class="c"># TODO: only open file once and leave the file open; then seek back and forth;</span>
        <span class="c">#       should improve performance substantially</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">openany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>  <span class="c"># forward to frame</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ENDMDL&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="c"># NOTE - CRYST1 line won&#39;t be found if it comes before the MODEL line,</span>
                <span class="c"># which is sometimes the case, e.g. output from gromacs trjconv</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;CRYST1&#39;</span><span class="p">:</span>
                    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">24</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">33</span><span class="p">]])</span>
                    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">40</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ATOM  &#39;</span><span class="p">,</span> <span class="s">&#39;HETATM&#39;</span><span class="p">):</span>
                    <span class="c"># we only care about coordinates</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">38</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">46</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">54</span><span class="p">]])</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c"># TODO import bfactors - might these change?</span>
                    <span class="n">occupancy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">54</span><span class="p">:</span><span class="mi">60</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_occupancy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occupancy</span><span class="p">)</span>
                    <span class="k">continue</span>

        <span class="c"># check if atom number changed</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numatoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Read an incorrect number of atoms</span><span class="se">\n</span><span class="s">&quot;</span>
                             <span class="s">&quot;Expected {expected} got {actual}&quot;</span>
                             <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_numatoms</span><span class="p">,</span> <span class="n">actual</span><span class="o">=</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>  <span class="c"># in-place !</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>  <span class="c"># in-place ! (only lengths)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>

</div>
<div class="viewcode-block" id="PrimitivePDBWriter"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter">[docs]</a><span class="k">class</span> <span class="nc">PrimitivePDBWriter</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Writer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDB writer that implements a subset of the `PDB 3.2 standard`_ .</span>

<span class="sd">    PDB format as used by NAMD/CHARMM: 4-letter resnames and segID are allowed,</span>
<span class="sd">    altLoc is written.</span>

<span class="sd">    The :class:`PrimitivePDBWriter` can be used to either a dump a coordinate</span>
<span class="sd">    set to a PDB file (operating as a &quot;single frame writer&quot;, selected with the</span>
<span class="sd">    constructor keyword *multiframe* = ``False``, the default) or by writing a</span>
<span class="sd">    PDB &quot;movie&quot; (multi frame mode, *multiframe* = ``True``), consisting of</span>
<span class="sd">    multiple models (using the MODEL_ and ENDMDL_ records).</span>

<span class="sd">    .. _`PDB 3.2 standard`:</span>
<span class="sd">       http://www.wwpdb.org/documentation/format32/v3.2.html</span>
<span class="sd">    .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">    .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>
<span class="sd">    .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>

<span class="sd">    .. SeeAlso::</span>
<span class="sd">       This class is identical to :class:`MultiPDBWriter` with the one</span>
<span class="sd">       exception that it defaults to writing single-frame PDB files as if</span>
<span class="sd">       *multiframe* = ``False`` was selected.</span>

<span class="sd">    .. versionchanged:: 0.7.5</span>
<span class="sd">       Initial support for multi-frame PDB files.</span>

<span class="sd">    .. versionchanged:: 0.7.6</span>
<span class="sd">       The *multiframe* keyword was added to select the writing mode. The writing</span>
<span class="sd">       of bond information (CONECT_ records) is now disabled by default but can be</span>
<span class="sd">       enabled with the *bonds* keyword.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#          1         2         3         4         5         6         7         8</span>
    <span class="c"># 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789.</span>
    <span class="c"># ATOM__seria nameAres CressI   xxxxxxxxyyyyyyyyzzzzzzzzOCCUPAtempft          elCH</span>
    <span class="c"># ATOM  %5d   %-4s %-3s %4d %1s %8.3f   %8.3f   %8.3f   %6.2f %6.2f           %2s</span>
    <span class="c">#                 %1s  %1s                                                      %2d</span>
    <span class="c">#            =        =      ===                                    ==========</span>
    <span class="c"># ATOM  %5d %-4s%1s%-3s %1s%4d%1s   %8.3f%8.3f%8.3f%6.2f%6.2f          %2s%2d</span>
    <span class="c"># ATOM  %(serial)5d %(name)-4s%(altLoc)1s%(resName)-3s %(chainID)1s%(resSeq)4d%(iCode)1s   %(x)8.3f%(y)8.3f%(</span>
    <span class="c"># z)8.3f%(occupancy)6.2f%(tempFactor)6.2f          %(element)2s%(charge)2d</span>

    <span class="c"># Strict PDB format:</span>
    <span class="c">#fmt = {&#39;ATOM&#39;:   &quot;ATOM  %(serial)5d %(name)-4s%(altLoc)1s%(resName)-3s %(chainID)1s%(resSeq)4d%(iCode)1s   %(</span>
    <span class="c"># x)8.3f%(y)8.3f%(z)8.3f%(occupancy)6.2f%(tempFactor)6.2f          %(element)2s%(charge)2d\n&quot;,</span>
    <span class="c"># PDB format as used by NAMD/CHARMM: 4-letter resnames and segID, altLoc ignored</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;ATOM&#39;</span><span class="p">:</span> <span class="s">&quot;ATOM  </span><span class="si">%(serial)5d</span><span class="s"> </span><span class="si">%(name)-4s%(altLoc)-1s%(resName)-4s%(chainID)1s%(resSeq)4d%(iCode)1s</span><span class="s">   </span><span class="si">%(x)8.3f</span><span class="s">%(&quot;</span>
                <span class="s">&quot;y)8.3f</span><span class="si">%(z)8.3f%(occupancy)6.2f%(tempFactor)6.2f</span><span class="s">      </span><span class="si">%(segID)-4s%(element)2s%(charge)2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;REMARK&#39;</span><span class="p">:</span> <span class="s">&quot;REMARK     </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;COMPND&#39;</span><span class="p">:</span> <span class="s">&quot;COMPND    </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;HEADER&#39;</span><span class="p">:</span> <span class="s">&quot;HEADER    </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;TITLE&#39;</span><span class="p">:</span> <span class="s">&quot;TITLE     </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;MODEL&#39;</span><span class="p">:</span> <span class="s">&quot;MODEL     </span><span class="si">%5d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;NUMMDL&#39;</span><span class="p">:</span> <span class="s">&quot;NUMMDL    </span><span class="si">%5d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;ENDMDL&#39;</span><span class="p">:</span> <span class="s">&quot;ENDMDL</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;END&#39;</span><span class="p">:</span> <span class="s">&quot;END</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;CRYST1&#39;</span><span class="p">:</span> <span class="s">&quot;CRYST1</span><span class="si">%9.3f%9.3f%9.3f%7.2f%7.2f%7.2f</span><span class="s"> </span><span class="si">%-11s%4d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;CONECT&#39;</span><span class="p">:</span> <span class="s">&quot;CONECT</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="p">}</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;PDB&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;length&#39;</span><span class="p">:</span> <span class="s">&#39;Angstrom&#39;</span><span class="p">}</span>
    <span class="n">pdb_coor_limits</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">999.9995</span><span class="p">,</span> <span class="s">&quot;max&quot;</span><span class="p">:</span> <span class="mf">9999.9995</span><span class="p">}</span>
    <span class="c">#: wrap comments into REMARK records that are not longer than</span>
    <span class="c"># :attr:`remark_max_length` characters.</span>
    <span class="n">remark_max_length</span> <span class="o">=</span> <span class="mi">66</span>
    <span class="n">_multiframe</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">bonds</span><span class="o">=</span><span class="s">&quot;conect&quot;</span><span class="p">,</span> <span class="n">numatoms</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">remarks</span><span class="o">=</span><span class="s">&quot;Created by PrimitivePDBWriter&quot;</span><span class="p">,</span>
                 <span class="n">convert_units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new PDBWriter</span>

<span class="sd">        :Arguments:</span>
<span class="sd">         *filename*</span>
<span class="sd">           name of output file</span>
<span class="sd">         *start*</span>
<span class="sd">           starting timestep</span>
<span class="sd">         *step*</span>
<span class="sd">           skip between subsequent timesteps</span>
<span class="sd">         *remarks*</span>
<span class="sd">           comments to annotate pdb file (added to the TITLE record); note that</span>
<span class="sd">           any remarks from the trajectory that serves as input are</span>
<span class="sd">           written to REMARK records with lines longer than :attr:`remark_max_length` (66</span>
<span class="sd">           characters) being wrapped.</span>
<span class="sd">         *convert_units*</span>
<span class="sd">           units are converted to the MDAnalysis base format; ``None`` selects</span>
<span class="sd">           the value of :data:`MDAnalysis.core.flags` [&#39;convert_lengths&#39;]</span>
<span class="sd">         *bonds*</span>
<span class="sd">           write bonds to the PDB file as CONECT_ records [``False``]</span>

<span class="sd">           .. Note::</span>

<span class="sd">              Currently only works when writing a whole :class:`Universe` and</span>
<span class="sd">              if bond information is available in the topology. (For selections</span>
<span class="sd">              smaller than the whole :class:`Universe`, the atom numbering in</span>
<span class="sd">              the CONECT_ records would not match the numbering of the atoms in</span>
<span class="sd">              the new PDB file and therefore a :exc:`NotImplementedError` is</span>
<span class="sd">              raised.)</span>

<span class="sd">         *multiframe*</span>
<span class="sd">           ``False``: write a single frame to the file; ``True``: create a</span>
<span class="sd">           multi frame PDB file in which frames are written as MODEL_ ... ENDMDL_</span>
<span class="sd">           records. If ``None``, then the class default is chosen.    [``None``]</span>

<span class="sd">        .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>
<span class="sd">        .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">        .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># numatoms = None : dummy keyword argument</span>
        <span class="c"># (not used, but Writer() always provides numatoms as the second argument)</span>

        <span class="c"># TODO: - remarks should be a list of lines and written to REMARK</span>
        <span class="c">#       - additional title keyword could contain line for TITLE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">convert_units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">convert_units</span> <span class="o">=</span> <span class="n">MDAnalysis</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s">&#39;convert_lengths&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span> <span class="o">=</span> <span class="n">convert_units</span>  <span class="c"># convert length and time to base units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiframe</span> <span class="k">if</span> <span class="n">multiframe</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">multiframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="n">bonds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;&#39;Start&#39; must be a positive value&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span> <span class="o">=</span> <span class="n">remarks</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">anyopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>  <span class="c"># open file on init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="PrimitivePDBWriter.close"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close PDB file and write END record&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;pdbfile&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">END</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;END record has already been written before the final closing of the file&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="k">def</span> <span class="nf">_write_pdb_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiframe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TITLE</span><span class="p">(</span><span class="s">&quot;MDANALYSIS FRAMES FROM </span><span class="si">%d</span><span class="s">, SKIP </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TITLE</span><span class="p">(</span><span class="s">&quot;MDANALYSIS FRAME </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_pdb_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;universe&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_title</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">universe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HEADER</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_title</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">COMPND</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># currently inconsistent: DCDReader gives a string, PDB*Reader a list, so always get a list</span>
            <span class="c"># split long single lines into chunks of 66 chars</span>
            <span class="n">remarks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">util</span><span class="o">.</span><span class="n">asiterable</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">remarks</span><span class="p">):</span>
                <span class="n">remarks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remark_max_length</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">REMARK</span><span class="p">(</span><span class="o">*</span><span class="n">remarks</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CRYST1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_dimensions_to_unitcell</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="p">))</span>

<div class="viewcode-block" id="PrimitivePDBWriter._check_pdb_coordinates"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter._check_pdb_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">_check_pdb_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the coordinate values fall within the range allowed for PDB files.</span>

<span class="sd">        Deletes the output file if this is the first frame or if frames have</span>
<span class="sd">        already been written (in multi-frame mode) adds a REMARK instead of the</span>
<span class="sd">        coordinates and closes the file.</span>

<span class="sd">        Raises :exc:`ValueError` if the coordinates fail the check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span>  <span class="c"># make sure to use atoms (Issue 46)</span>
        <span class="n">coor</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span>  <span class="c"># can write from selection == Universe (Issue 49)</span>

        <span class="c"># check if any coordinates are illegal (coordinates are already in Angstroem per package default)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_coor_limits</span><span class="p">,</span> <span class="n">coor</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="c"># note the precarious close() here: we know that the file is open and we now</span>
        <span class="c"># prepare to remove what we have already written (header and such) or add a REMARK</span>
        <span class="c"># (which allows the user to look at the previously written frames)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">REMARK</span><span class="p">(</span><span class="s">&quot;Incomplete multi-frame trajectory.&quot;</span><span class="p">,</span>
                        <span class="s">&quot;Coordinates for the current frame cannot be represented in the PDB format.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s">&quot;PDB files must have coordinate values between </span><span class="si">%.3f</span><span class="s"> and </span><span class="si">%.3f</span><span class="s"> Angstroem: file writing was aborted.&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_coor_limits</span><span class="p">[</span><span class="s">&quot;min&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb_coor_limits</span><span class="p">[</span><span class="s">&quot;max&quot;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter._write_pdb_bonds"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter._write_pdb_bonds">[docs]</a>    <span class="k">def</span> <span class="nf">_write_pdb_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes out all the bond records; works only for Universe objects.</span>

<span class="sd">        .. Warning::</span>

<span class="sd">           All bonds are written out, using the old atom numbers - this is</span>
<span class="sd">           incorrect. Once a selection is made, the atom numbers have to be</span>
<span class="sd">           updated (currently they are unmodified) and bonds have to be</span>
<span class="sd">           selected for, only if all the atoms for a bond are still present.</span>

<span class="sd">           Therefore, this method raises a :exc:`NotImplementedError` if CONECT</span>
<span class="sd">           records for anything smaller than the :class:`Universe` are written.</span>

<span class="sd">        .. versionchanged:: 0.7.6</span>
<span class="sd">           Only write CONECT records if :attr:`PrimitivePDBWriter.bonds` ``== True``.</span>
<span class="sd">           Raises :exc:`NotImplementedError` if it would produce wrong output.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># TODO: The bonds should not be a list of ints, as are now, but a list</span>
        <span class="c">#       of Atom objects.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;universe&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="p">,</span> <span class="s">&#39;bonds&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">numberOfAtoms</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">numberOfAtoms</span><span class="p">():</span>
            <span class="k">pass</span>
            <span class="c">#logger.error(&quot;PDB CONECT records not written because this only works correctly for a whole Universe.&quot;)</span>
            <span class="c">#raise NotImplementedError(&quot;PDB CONECT records not written because this only works correctly for a whole</span>
            <span class="c"># Universe.&quot;)</span>

        <span class="n">bonds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="p">[[</span><span class="n">bonds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">bonds</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>

        <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">atom</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">)])</span>

        <span class="c"># Write out only the bonds that were defined in CONECT records</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">==</span> <span class="s">&quot;conect&quot;</span><span class="p">:</span>
            <span class="n">bonds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonds</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bond</span><span class="o">.</span><span class="n">is_guessed</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">bonds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;bonds has to be either None, &#39;conect&#39; or &#39;all&#39;&quot;</span><span class="p">)</span>
        <span class="n">con</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a1</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">con</span><span class="p">:</span>
                <span class="n">con</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">con</span><span class="p">:</span>
                <span class="n">con</span><span class="p">[</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">con</span><span class="p">[</span><span class="n">a2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">con</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>

        <span class="c">#print con</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>

        <span class="n">conect</span> <span class="o">=</span> <span class="p">[([</span><span class="n">a</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">con</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">con</span><span class="p">]</span>

        <span class="n">conect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">mapping</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">conect</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CONECT</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter._update_frame"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter._update_frame">[docs]</a>    <span class="k">def</span> <span class="nf">_update_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to initialize important attributes in writer from a AtomGroup or Universe *obj*.</span>

<span class="sd">        Attributes initialized/updated:</span>

<span class="sd">        * :attr:`PrimitivePDBWriter.obj` (the entity that provides topology information *and*</span>
<span class="sd">          coordinates, either a :class:`~MDAnalysis.core.AtomGroup.AtomGroup` or a whole</span>
<span class="sd">          :class:`~MDAnalysis.core.AtomGroup.Universe`)</span>
<span class="sd">        * :attr:`PrimitivePDBWriter.trajectory` (the underlying trajectory</span>
<span class="sd">          :class:`~MDAnalysis.coordinates.base.Reader`)</span>
<span class="sd">        * :attr:`PrimitivePDBWriter.timestep` (the underlying trajectory</span>
<span class="sd">          :class:`~MDAnalysis.coordinates.base.Timestep`)</span>

<span class="sd">        Before calling :meth:`write_next_timestep` this method **must** be</span>
<span class="sd">        called at least once to enable extracting topology information from the</span>
<span class="sd">        current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">Timestep</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s">&quot;PrimitivePDBWriter cannot write Timestep objects directly, since they lack topology information (&quot;</span>
                <span class="s">&quot;atom names and types) required in PDB files&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>  <span class="c"># remember obj for some of other methods  --- NOTE: this is an evil/lazy hack...</span>
        <span class="n">ts</span><span class="p">,</span> <span class="n">traj</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;universe&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Universe</span><span class="p">):</span>
            <span class="c"># For AtomGroup and children (Residue, ResidueGroup, Segment)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span>
            <span class="n">traj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># For Universe only</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span>
            <span class="n">traj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trajectory</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">and</span> <span class="n">traj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s">&quot;PrimitivePDBWriter couldn&#39;t extract trajectory and timestep information from an object; inheritance &quot;</span>
                <span class="s">&quot;problem.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="n">traj</span>  <span class="c"># update trajectory (used by other methods)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>  <span class="c"># update timestep (used by other methods)</span>
        <span class="k">return</span> <span class="n">traj</span><span class="p">,</span> <span class="n">ts</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.write"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write object *obj* at current trajectory frame to file.</span>

<span class="sd">        *obj* can be a selection (i.e. a</span>
<span class="sd">        :class:`~MDAnalysis.core.AtomGroup.AtomGroup`) or a whole</span>
<span class="sd">        :class:`~MDAnalysis.core.AtomGroup.Universe`.</span>

<span class="sd">        The last letter of the :attr:`~MDAnalysis.core.AtomGroup.Atom.segid` is</span>
<span class="sd">        used as the PDB chainID (but see :meth:`~PrimitivePDBWriter.ATOM` for</span>
<span class="sd">        details).</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          *obj*</span>
<span class="sd">            :class:`~MDAnalysis.core.AtomGroup.AtomGroup` or</span>
<span class="sd">            :class:`~MDAnalysis.core.AtomGroup.Universe`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_frame</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_header</span><span class="p">()</span>
        <span class="c"># Issue 105: with write() ONLY write a single frame; use write_all_timesteps() to dump</span>
        <span class="c"># everything in one go, or do the traditional loop over frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiframe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_bonds</span><span class="p">()</span>
        <span class="c"># END record is written when file is being close()d</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.write_all_timesteps"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.write_all_timesteps">[docs]</a>    <span class="k">def</span> <span class="nf">write_all_timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write all timesteps associated with *obj* to the PDB file.</span>

<span class="sd">        *obj* can be a :class:`~MDAnalysis.core.AtomGroup.AtomGroup`</span>
<span class="sd">        or a :class:`~MDAnalysis.core.AtomGroup.Universe`.</span>

<span class="sd">        The method writes the frames from the one specified as *start* until</span>
<span class="sd">        the end, using a step of *skip* (*start* and *skip* are set in the</span>
<span class="sd">        constructor). Thus, if *u* is a Universe then ::</span>

<span class="sd">           u.trajectory[-2]</span>
<span class="sd">           pdb = PrimitivePDBWriter(&quot;out.pdb&quot;, u.atoms.numberOfAtoms())</span>
<span class="sd">           pdb.write_all_timesteps(u)</span>

<span class="sd">        will write a PDB trajectory containing the last 2 frames and ::</span>

<span class="sd">           pdb = PrimitivePDBWriter(&quot;out.pdb&quot;, u.atoms.numberOfAtoms(), start=12, skip=2)</span>
<span class="sd">           pdb.write_all_timesteps(u)</span>

<span class="sd">        will be writing frames 12, 14, 16, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_frame</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_header</span><span class="p">()</span>

        <span class="n">start</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span>

        <span class="c"># Start from trajectory[0]/frame 1, if there are more than 1 frame.</span>
        <span class="c"># If there is onyl 1 frame, the traj.frames is not like a python list:</span>
        <span class="c"># accessing trajectory[-1] raises key error.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">traj</span><span class="o">.</span><span class="n">numframes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">frame</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">framenumber</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">traj</span><span class="p">),</span> <span class="n">step</span><span class="p">):</span>
            <span class="n">traj</span><span class="p">[</span><span class="n">framenumber</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pdb_bonds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Set the trajectory to the starting position</span>
        <span class="n">traj</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.write_next_timestep"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.write_next_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">write_next_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write a new timestep to the PDB file</span>

<span class="sd">        :Keywords:</span>
<span class="sd">          *ts*</span>
<span class="sd">             :class:`base.Timestep` object containing coordinates to be written to trajectory file;</span>
<span class="sd">             if ``None`` then :attr:`PrimitivePDBWriter.ts`` is tried.</span>
<span class="sd">          *multiframe*</span>
<span class="sd">             ``False``: write a single frame (default); ``True`` behave as a trajectory writer</span>

<span class="sd">        .. Note::</span>

<span class="sd">           Before using this method with another :class:`base.Timestep` in the *ts*</span>
<span class="sd">           argument, :meth:`PrimitivePDBWriter._update_frame` *must* be called</span>
<span class="sd">           with the :class:`~MDAnalysis.core.AtomGroup.AtomGroup.Universe` as</span>
<span class="sd">           its argument so that topology information can be gathered.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;ts&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">NoDataError</span><span class="p">(</span><span class="s">&quot;PBDWriter: no coordinate data to write to trajectory file&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pdb_coordinates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_timestep</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter._write_timestep"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter._write_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">_write_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">multiframe</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write a new timestep *ts* to file</span>

<span class="sd">        Does unit conversion if necessary.</span>

<span class="sd">        By setting *multiframe* = ``True``, MODEL_ ... ENDMDL_ records are</span>
<span class="sd">        written to represent trajectory frames in a multi-model PDB file. (At</span>
<span class="sd">        the moment we do *not* write the NUMMDL_ record.)</span>

<span class="sd">        The *multiframe* = ``False`` keyword signals that the</span>
<span class="sd">        :class:`PrimitivePDBWriter` is in single frame mode and no MODEL_</span>
<span class="sd">        records are written.</span>

<span class="sd">        .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">        .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>
<span class="sd">        .. _NUMMDL: http://www.wwpdb.org/documentation/format32/sect2.html#NUMMDL</span>

<span class="sd">        .. versionchanged:: 0.7.6</span>
<span class="sd">           The *multiframe* keyword was added, which completely determines if</span>
<span class="sd">           MODEL records are written. (Previously, this was decided based on the</span>
<span class="sd">           underlying trajectory and only if ``len(traj) &gt; 1`` would MODEL records</span>
<span class="sd">           have been written.)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">atoms</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="n">coor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_to_native</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coor</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">_pos</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;indices&quot;</span><span class="p">):</span>
            <span class="n">coor</span> <span class="o">=</span> <span class="n">coor</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">indices</span><span class="p">()]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;Length of the atoms array is </span><span class="si">%d</span><span class="s">, this is different form the Timestep coordinate array </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">multiframe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MODEL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
            <span class="c"># TODO Jan: see description in ATOM for why this check has to be made</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">atom</span><span class="o">.</span><span class="n">bfactor</span><span class="p">:</span>
                <span class="n">atom</span><span class="o">.</span><span class="n">bfactor</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ATOM</span><span class="p">(</span><span class="n">serial</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">resName</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                      <span class="n">resSeq</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">chainID</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">segid</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">segID</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">segid</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                      <span class="n">tempFactor</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">bfactor</span><span class="p">,</span> <span class="n">altLoc</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">altLoc</span><span class="p">,</span>
                      <span class="n">x</span><span class="o">=</span><span class="n">coor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">coor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">coor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="c"># get bfactor, too, and add to output?</span>
            <span class="c"># &#39;element&#39; is auto-guessed from atom.name in ATOM()</span>
        <span class="k">if</span> <span class="n">multiframe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ENDMDL</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames_written</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.HEADER"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.HEADER">[docs]</a>    <span class="k">def</span> <span class="nf">HEADER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write HEADER_ record.</span>

<span class="sd">        .. _HEADER: http://www.wwpdb.org/documentation/format32/sect2.html#HEADER</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="s">&#39;header&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;HEADER&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">header</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.TITLE"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.TITLE">[docs]</a>    <span class="k">def</span> <span class="nf">TITLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write TITLE_ record.</span>

<span class="sd">        .. _TITLE: http://www.wwpdb.org/documentation/format32/sect2.html</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>  <span class="c"># TODO: should do continuation automatically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;TITLE&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.REMARK"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.REMARK">[docs]</a>    <span class="k">def</span> <span class="nf">REMARK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">remarks</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write generic REMARK_ record (without number).</span>

<span class="sd">        Each string provided in *remarks* is written as a separate REMARK_</span>
<span class="sd">        record.</span>

<span class="sd">        See also `REMARK (update)`_.</span>

<span class="sd">        .. _REMARK: http://www.wwpdb.org/documentation/format32/remarks1.html</span>
<span class="sd">        .. _REMARK (update): http://www.wwpdb.org/documentation/format32/remarks2.html</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">remark</span> <span class="ow">in</span> <span class="n">remarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;REMARK&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="n">remark</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">COMPND</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="s">&#39;compound&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">compound</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">compound</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">compound</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;COMPND&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>

<div class="viewcode-block" id="PrimitivePDBWriter.CRYST1"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.CRYST1">[docs]</a>    <span class="k">def</span> <span class="nf">CRYST1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">spacegroup</span><span class="o">=</span><span class="s">&#39;P 1&#39;</span><span class="p">,</span> <span class="n">zvalue</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write CRYST1_ record.</span>

<span class="sd">        .. _CRYST1: http://www.wwpdb.org/documentation/format32/sect8.html</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;CRYST1&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spacegroup</span><span class="p">,</span> <span class="n">zvalue</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.MODEL"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.MODEL">[docs]</a>    <span class="k">def</span> <span class="nf">MODEL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelnumber</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the MODEL_ record.</span>

<span class="sd">        .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;MODEL&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">modelnumber</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.END"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.END">[docs]</a>    <span class="k">def</span> <span class="nf">END</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write END_ record.</span>

<span class="sd">        Only a single END record is written. Calling END multiple times has no</span>
<span class="sd">        effect. Because :meth:`~PrimitivePDBWriter.close` also calls this</span>
<span class="sd">        method right before closing the file it is recommended to *not* call</span>
<span class="sd">        :meth:`~PrimitivePDBWriter.END` explicitly.</span>

<span class="sd">        .. _END: http://www.wwpdb.org/documentation/format32/sect11.html#END</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;END&#39;</span><span class="p">])</span>  <span class="c"># only write a single END record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_END</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.ENDMDL"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.ENDMDL">[docs]</a>    <span class="k">def</span> <span class="nf">ENDMDL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the ENDMDL_ record.</span>

<span class="sd">        .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;ENDMDL&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.ATOM"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.ATOM">[docs]</a>    <span class="k">def</span> <span class="nf">ATOM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serial</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">altLoc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">resName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">chainID</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">resSeq</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">iCode</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">occupancy</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tempFactor</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
             <span class="n">segID</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write ATOM_ record.</span>

<span class="sd">        Only some keword args are optional (*altLoc*, *iCode*, *chainID*), for</span>
<span class="sd">        some defaults are set.</span>

<span class="sd">        All inputs are cut to the maximum allowed length. For integer numbers</span>
<span class="sd">        the highest-value digits are chopped (so that the *serial* and *reSeq*</span>
<span class="sd">        wrap); for strings the trailing characters are chopped. The *last*</span>
<span class="sd">        character of *chainID* becomes the PDB *chainID* (unless it has the</span>
<span class="sd">        special value &quot;SYSTEM&quot; (assigned by MDAnalysis if neither *segID* nor</span>
<span class="sd">        *chainID* were available), in which case the PDB will have an empty</span>
<span class="sd">        *chainID*).</span>

<span class="sd">        .. Warning: Floats are not checked and can potentially screw up the format.</span>

<span class="sd">        .. _ATOM: http://www.wwpdb.org/documentation/format32/sect9.html</span>

<span class="sd">        .. versionchanged:: 0.7.6</span>
<span class="sd">           If the *chainID* has the special value &quot;SYSTEM&quot; (case insensitive)</span>
<span class="sd">           then the chain is set to the empty string &quot;&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># TODO Jan: PDBReader sets the bfactor value corretly to 0.0 if not</span>
        <span class="c"># defined, DCD error does not. Thus when saving a Universe(DCDfile), the</span>
        <span class="c"># bfactor is None rather than 0.0.</span>
        <span class="c">#</span>
        <span class="c"># Now in the `for` loop below we could remove the offending variable but</span>
        <span class="c"># this gets us when the fromat `ATOM` expects float and not NoneType.</span>
        <span class="c">#</span>
        <span class="c"># Provisional solution for now: custom check if tempfactor is None, in</span>
        <span class="c"># :meth:`_write_timestep`</span>
        <span class="c">#</span>
        <span class="c"># OB: The &quot;provisional&quot; solution is correct. ATOM requires the calling code</span>
        <span class="c">#     to provide a sane value for tempFactor. This is because a tempFactor of</span>
        <span class="c">#     0 might actually mean to some programs &quot;ignore this atom&quot;. Hence we</span>
        <span class="c">#     don&#39;t want to make this decision in the general I/O routine.</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s">&#39;serial&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;resName&#39;</span><span class="p">,</span> <span class="s">&#39;resSeq&#39;</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span>
                <span class="s">&#39;occupancy&#39;</span><span class="p">,</span> <span class="s">&#39;tempFactor&#39;</span><span class="p">,</span> <span class="s">&#39;charge&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">arg</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;parameter &#39;</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s">&#39; must be defined.&#39;</span><span class="p">)</span>
        <span class="n">serial</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">serial</span><span class="p">)[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>  <span class="c"># check for overflow here?</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">name</span>  <span class="c"># customary to start in column 14</span>
        <span class="n">altLoc</span> <span class="o">=</span> <span class="n">altLoc</span> <span class="ow">or</span> <span class="s">&quot; &quot;</span>
        <span class="n">altLoc</span> <span class="o">=</span> <span class="n">altLoc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">resName</span> <span class="o">=</span> <span class="n">resName</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">chainID</span> <span class="o">=</span> <span class="n">chainID</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>  <span class="c"># or should we provide a chainID such as &#39;A&#39;?</span>
        <span class="n">chainID</span> <span class="o">=</span> <span class="n">chainID</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">chainID</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;SYSTEM&quot;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>  <span class="c"># special case, new in 0.7.6</span>
        <span class="n">chainID</span> <span class="o">=</span> <span class="n">chainID</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>  <span class="c"># take the last character</span>
        <span class="n">resSeq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resSeq</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>  <span class="c"># check for overflow here?</span>
        <span class="n">iCode</span> <span class="o">=</span> <span class="n">iCode</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>
        <span class="n">iCode</span> <span class="o">=</span> <span class="n">iCode</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">element</span> <span class="ow">or</span> <span class="n">guess_atom_element</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>  <span class="c"># element == 0|False|None will be guessed</span>
        <span class="n">element</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>  <span class="c"># make sure that is a string for user input</span>
        <span class="n">segID</span> <span class="o">=</span> <span class="n">segID</span> <span class="ow">or</span> <span class="n">chainID</span>
        <span class="n">segID</span> <span class="o">=</span> <span class="n">segID</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;ATOM&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="PrimitivePDBWriter.CONECT"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.PrimitivePDBWriter.CONECT">[docs]</a>    <span class="k">def</span> <span class="nf">CONECT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conect</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write CONECT_ record.</span>

<span class="sd">        .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conect</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;</span><span class="si">%5d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">conect</span><span class="p">]</span>
        <span class="n">conect</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;CONECT&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">conect</span><span class="p">)</span>

</div></div>
<span class="k">class</span> <span class="nc">ExtendedPDBReader</span><span class="p">(</span><span class="n">PrimitivePDBReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDBReader that reads a PDB-formatted file with five-digit residue numbers.</span>

<span class="sd">    This reader does not conform to the `PDB standard`_ because it allows</span>
<span class="sd">    five-digit residue numbers that may take up columns 23 to 27 (inclusive)</span>
<span class="sd">    instead of being confined to 23-26 (with column 27 being reserved for the</span>
<span class="sd">    insertion code in the PDB standard). PDB files in this format are written</span>
<span class="sd">    by popular programs such as VMD_.</span>

<span class="sd">    .. SeeAlso:: :class:`PrimitivePDBReader`</span>

<span class="sd">    .. _PDB standard: http://www.wwpdb.org/documentation/format32/sect9.html</span>
<span class="sd">    .. _VMD: http://www.ks.uiuc.edu/Research/vmd/</span>

<span class="sd">    .. versionadded:: 0.8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&quot;XPDB&quot;</span>


<div class="viewcode-block" id="MultiPDBWriter"><a class="viewcode-back" href="../../../documentation_pages/coordinates/PDB.html#MDAnalysis.coordinates.PDB.MultiPDBWriter">[docs]</a><span class="k">class</span> <span class="nc">MultiPDBWriter</span><span class="p">(</span><span class="n">PrimitivePDBWriter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PDB writer that implements a subset of the `PDB 3.2 standard`_ .</span>

<span class="sd">    PDB format as used by NAMD/CHARMM: 4-letter resnames and segID, altLoc</span>
<span class="sd">    is written.</span>

<span class="sd">    By default, :class:`MultiPDBWriter` writes a PDB &quot;movie&quot; (multi frame mode,</span>
<span class="sd">    *multiframe* = ``True``), consisting of multiple models (using the MODEL_</span>
<span class="sd">    and ENDMDL_ records).</span>

<span class="sd">    .. _`PDB 3.2 standard`:</span>
<span class="sd">       http://www.wwpdb.org/documentation/format32/v3.2.html</span>

<span class="sd">    .. _MODEL: http://www.wwpdb.org/documentation/format32/sect9.html#MODEL</span>
<span class="sd">    .. _ENDMDL: http://www.wwpdb.org/documentation/format32/sect9.html#ENDMDL</span>
<span class="sd">    .. _CONECT: http://www.wwpdb.org/documentation/format32/sect10.html#CONECT</span>


<span class="sd">    .. SeeAlso::</span>
<span class="sd">       This class is identical to :class:`PrimitivePDBWriter` with the one</span>
<span class="sd">       exception that it defaults to writing multi-frame PDB files instead of</span>
<span class="sd">       single frames.</span>

<span class="sd">    .. versionadded:: 0.7.6</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_multiframe</span> <span class="o">=</span> <span class="bp">True</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MDAnalysis 0.10.0-dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../MDAnalysis.html" >MDAnalysis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2005-2015, Naveen Michaud-Agrawal, Elizabeth J. Denning, Joshua Adelman,
    Christian Beckstein (logo), Alejandro Bernardin, Sébastien Buchoux,
    David Caplan, Matthieu Chavent, Xavier Deupi, Jan Domański, David L. Dotson
    Lennard van der Feltz, Philip Fowler, Joseph Goose, Richard J. Gowers, Lukas Grossar,
    Benjamin Hall, Joe Jordan, Jinju Lu, Robert McGibbon, Alex Nesterenko,
    Manuel Nuno Melo, Caio S. Souza, Danny Parton, Joshua L. Phillips, Tyler Reddy,
    Paul Rigor, Sean L. Seyler, Andy Somogyi, Lukas Stelzl, Zhuyi Xue,
    and Oliver Beckstein.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>