

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MDAnalysis.topology.LAMMPSParser &mdash; MDAnalysis 0.10.0-dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.10.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.10.0-dev documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
    <link rel="top" title="MDAnalysis 0.10.0-dev documentation" href="../../../index.html" />
    <link rel="up" title="MDAnalysis" href="../../MDAnalysis.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MDAnalysis 0.10.0-dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../MDAnalysis.html" accesskey="U">MDAnalysis</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mdanalysis-logo-200x150.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MDAnalysis.topology.LAMMPSParser</h1><div class="highlight"><pre>
<span class="c"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4 fileencoding=utf-8</span>
<span class="c">#</span>
<span class="c"># MDAnalysis --- http://www.MDAnalysis.org</span>
<span class="c"># Copyright (c) 2006-2015 Naveen Michaud-Agrawal, Elizabeth J. Denning, Oliver Beckstein</span>
<span class="c"># and contributors (see AUTHORS for the full list)</span>
<span class="c">#</span>
<span class="c"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c">#</span>
<span class="c"># Please cite your use of MDAnalysis in published work:</span>
<span class="c"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">LAMMPSParser</span>
<span class="sd">============</span>

<span class="sd">The :func:`parse` function reads a LAMMPS_ data file to build a system</span>
<span class="sd">topology.</span>

<span class="sd">.. _LAMMPS: http://lammps.sandia.gov/</span>

<span class="sd">Classes</span>
<span class="sd">-------</span>

<span class="sd">.. autoclass:: DATAParser</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">Deprecated classes</span>
<span class="sd">------------------</span>

<span class="sd">.. autoclass:: LAMMPSDataConverter</span>
<span class="sd">   :members:</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="kn">from</span> <span class="nn">..core.AtomGroup</span> <span class="kn">import</span> <span class="n">Atom</span>
<span class="kn">from</span> <span class="nn">..core.util</span> <span class="kn">import</span> <span class="n">openany</span><span class="p">,</span> <span class="n">conv_float</span>
<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">TopologyReader</span>
<span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="n">guess_atom_mass</span><span class="p">,</span> <span class="n">guess_atom_charge</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;MDAnalysis.topology.LAMMPS&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="DATAParser"><a class="viewcode-back" href="../../../documentation_pages/topology/LAMMPSParser.html#MDAnalysis.topology.LAMMPSParser.DATAParser">[docs]</a><span class="k">class</span> <span class="nc">DATAParser</span><span class="p">(</span><span class="n">TopologyReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a LAMMPS DATA file for topology and coordinates.</span>

<span class="sd">    Note that LAMMPS_ DATA files can be used standalone.</span>

<span class="sd">    Both topology and coordinate parsing functionality is kept in this</span>
<span class="sd">    class as the topology and coordinate reader share many common</span>
<span class="sd">    functions</span>

<span class="sd">    The parser implements the `LAMMPS DATA file format`_ but only for</span>
<span class="sd">    the LAMMPS `atom_style`_ *full* (numeric ids 7, 10) and</span>
<span class="sd">    *molecular* (6, 9).</span>

<span class="sd">    .. _LAMMPS DATA file format: :http://lammps.sandia.gov/doc/2001/data_format.html</span>
<span class="sd">    .. _`atom_style`: http://lammps.sandia.gov/doc/atom_style.html</span>

<span class="sd">    .. versionadded:: 0.9.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DATAParser.parse"><a class="viewcode-back" href="../../../documentation_pages/topology/LAMMPSParser.html#MDAnalysis.topology.LAMMPSParser.DATAParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parses a LAMMPS_ DATA file.</span>

<span class="sd">        :Returns: MDAnalysis internal *structure* dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Can pass atom_style to help parsing</span>
        <span class="n">atom_style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;atom_style&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># Used this to do data format:</span>
        <span class="c"># http://lammps.sandia.gov/doc/2001/data_format.html</span>
        <span class="k">with</span> <span class="n">openany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">psffile</span><span class="p">:</span>
            <span class="c"># Check format of file somehow</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">nitems</span><span class="p">,</span> <span class="n">ntypes</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_header</span><span class="p">(</span><span class="n">psffile</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Failed to read DATA header&quot;</span><span class="p">)</span>

            <span class="n">strkey</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;Bonds&#39;</span><span class="p">:</span> <span class="s">&#39;bonds&#39;</span><span class="p">,</span>
                <span class="s">&#39;Angles&#39;</span><span class="p">:</span> <span class="s">&#39;angles&#39;</span><span class="p">,</span>
                <span class="s">&#39;Dihedrals&#39;</span><span class="p">:</span> <span class="s">&#39;torsions&#39;</span><span class="p">,</span>
                <span class="s">&#39;Impropers&#39;</span><span class="p">:</span> <span class="s">&#39;impropers&#39;</span><span class="p">}</span>
            <span class="n">nentries</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;bonds&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s">&#39;angles&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s">&#39;torsions&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s">&#39;impropers&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
            <span class="c"># Masses can appear after Atoms section.</span>
            <span class="c"># If this happens, this blank dict will be used and all atoms</span>
            <span class="c"># will have zero mass, can fix this later</span>
            <span class="n">masses</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">read_masses</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">read_coords</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c"># Now go through section by section</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">section</span> <span class="o">=</span> <span class="n">psffile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">section</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>  <span class="c"># blank lines don&#39;t split</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Parsing section &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="s">&#39;Atoms&#39;</span><span class="p">:</span>
                    <span class="n">fix_masses</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">read_masses</span> <span class="k">else</span> <span class="bp">True</span>

                    <span class="n">structure</span><span class="p">[</span><span class="s">&#39;atoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_atoms</span><span class="p">(</span><span class="n">psffile</span><span class="p">,</span>
                                                           <span class="n">nitems</span><span class="p">[</span><span class="s">&#39;atoms&#39;</span><span class="p">],</span>
                                                           <span class="n">masses</span><span class="p">,</span>
                                                           <span class="n">atom_style</span><span class="p">)</span>
                    <span class="n">read_coords</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="s">&#39;Masses&#39;</span><span class="p">:</span>
                    <span class="n">read_masses</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">masses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_masses</span><span class="p">(</span><span class="n">psffile</span><span class="p">,</span> <span class="n">ntypes</span><span class="p">[</span><span class="s">&#39;atoms&#39;</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Failed to read masses section&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">strkey</span><span class="p">:</span>  <span class="c"># for sections we use in MDAnalysis</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Doing strkey section for {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="p">))</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">strkey</span><span class="p">[</span><span class="n">section</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">structure</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_section</span><span class="p">(</span><span class="n">psffile</span><span class="p">,</span>
                                                           <span class="n">nitems</span><span class="p">[</span><span class="n">f</span><span class="p">],</span>
                                                           <span class="n">nentries</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Failed to read section {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># for sections we don&#39;t use in MDAnalysis</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Skipping section, found: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_skip_section</span><span class="p">(</span><span class="n">psffile</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c"># for blank lines</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">read_coords</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Failed to find coordinate data&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fix_masses</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">[</span><span class="s">&#39;atoms&#39;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="c">#                        a.mass = guess_atom_mass(a.name)</span>

            <span class="k">return</span> <span class="n">structure</span>
</div>
<div class="viewcode-block" id="DATAParser.read_DATA_timestep"><a class="viewcode-back" href="../../../documentation_pages/topology/LAMMPSParser.html#MDAnalysis.topology.LAMMPSParser.DATAParser.read_DATA_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">read_DATA_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read a DATA file and try and extract x, v, box.</span>

<span class="sd">        - positions</span>
<span class="sd">        - velocities (optional)</span>
<span class="sd">        - box information</span>

<span class="sd">        Fills this into the Timestep object and returns it</span>

<span class="sd">        .. versionadded:: 0.9.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">read_atoms</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">read_velocities</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">with</span> <span class="n">openany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">datafile</span><span class="p">:</span>
            <span class="n">nitems</span><span class="p">,</span> <span class="n">ntypes</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_header</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>

            <span class="c"># lammps box: xlo, xhi, ylo, yhi, zlo, zhi</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ly</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">lz</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">box</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="c"># mda unitcell: A alpha B beta gamma C</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">lz</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">90.0</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">read_atoms</span> <span class="o">&amp;</span> <span class="n">read_velocities</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">section</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>  <span class="c"># blank lines don&#39;t split</span>
                    <span class="n">section</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="s">&#39;Atoms&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parse_pos</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>
                    <span class="n">read_atoms</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="s">&#39;Velocities&#39;</span><span class="p">:</span>
                    <span class="n">ts</span><span class="o">.</span><span class="n">_velocities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ts</span><span class="o">.</span><span class="n">numatoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                                 <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parse_vel</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">_velocities</span><span class="p">)</span>
                    <span class="n">read_velocities</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_skip_section</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">read_atoms</span><span class="p">:</span>  <span class="c"># Reaches here if StopIteration hit</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Position information not found&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ts</span>
</div>
    <span class="k">def</span> <span class="nf">_parse_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Strip coordinate info into np array&quot;&quot;&quot;</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">atype</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_atom_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="c"># assumes atom ids are well behaved?</span>
            <span class="c"># LAMMPS sometimes dumps atoms in random order</span>
            <span class="n">pos</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">_parse_atom_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a atom line into MDA stuff</span>

<span class="sd">        Atom styles are customisable in LAMMPS.  To add different atom types</span>
<span class="sd">        you&#39;d put them here.</span>

<span class="sd">        You could try and allow any type of atom type by making this method</span>
<span class="sd">        look in the kwargs for a custom atom definition... Users could then</span>
<span class="sd">        pass a function which decodes their atom style to the topology reader</span>

<span class="sd">        This ultimately needs to return:</span>
<span class="sd">          id, resid, atom type, charge, x, y, z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="c"># logger.debug(&#39;Line length: {}&#39;.format(n))</span>
        <span class="c"># logger.debug(&#39;Line is {}&#39;.format(line))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">guess_atom_charge</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c"># charge is zero by default</span>

        <span class="n">idx</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">atype</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="c"># 0 based atom ids in mda, 1 based in lammps</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">]:</span>  <span class="c"># atom_style full</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]:</span>  <span class="c"># atom_style molecular</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">idx</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">atype</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">_parse_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">vel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Strip velocity info into np array&quot;&quot;&quot;</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">vel</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span>

    <span class="k">def</span> <span class="nf">_parse_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">nlines</span><span class="p">,</span> <span class="n">nentries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read lines and strip information&quot;&quot;&quot;</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">section</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nlines</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c"># logging.debug(&quot;Line is: {}&quot;.format(line))</span>
            <span class="c"># map to 0 based int</span>
            <span class="n">section</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span> <span class="o">+</span> <span class="n">nentries</span><span class="p">])))</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">natoms</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">atom_style</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Special parsing for atoms</span>

<span class="sd">        Lammps atoms can have lots of different formats, and even custom formats.</span>

<span class="sd">        http://lammps.sandia.gov/doc/atom_style.html</span>

<span class="sd">        Treated here are</span>
<span class="sd">        - atoms with 7 fields (with charge) &quot;full&quot;</span>
<span class="sd">        - atoms with 6 fields (no charge) &quot;molecular&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Doing Atoms section&quot;</span><span class="p">)</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c"># logger.debug(&quot;Line: {} contains: {}&quot;.format(i, line))</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">atype</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_atom_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">atype</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">mass</span><span class="p">[</span><span class="n">atype</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c">#                m = guess_atom_mass(name)  # i think types are just ints though?</span>
            <span class="c"># Atom() format:</span>
            <span class="c"># Number, name, type, resname, resid, segid, mass, charge</span>
            <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Atom</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">atype</span><span class="p">,</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">resid</span><span class="p">),</span> <span class="n">resid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resid</span><span class="p">),</span>
                              <span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">universe</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_u</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">atoms</span>

    <span class="k">def</span> <span class="nf">_parse_masses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">ntypes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lammps defines mass on a per atom basis.</span>

<span class="sd">        This reads mass for each type and stores in dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Doing Masses section&quot;</span><span class="p">)</span>

        <span class="n">masses</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ntypes</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">masses</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">masses</span>

    <span class="k">def</span> <span class="nf">_skip_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read lines but don&#39;t parse&quot;&quot;&quot;</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_parse_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the header of DATA file</span>

<span class="sd">        This should be fixed in all files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hvals</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;atoms&#39;</span><span class="p">:</span> <span class="s">&#39;atoms&#39;</span><span class="p">,</span>
            <span class="s">&#39;bonds&#39;</span><span class="p">:</span> <span class="s">&#39;bonds&#39;</span><span class="p">,</span>
            <span class="s">&#39;angles&#39;</span><span class="p">:</span> <span class="s">&#39;angles&#39;</span><span class="p">,</span>
            <span class="s">&#39;dihedrals&#39;</span><span class="p">:</span> <span class="s">&#39;torsions&#39;</span><span class="p">,</span>
            <span class="s">&#39;impropers&#39;</span><span class="p">:</span> <span class="s">&#39;impropers&#39;</span><span class="p">}</span>
        <span class="n">nitems</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">hvals</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>  <span class="c"># Title</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>  <span class="c"># Blank line</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">nitems</span><span class="p">[</span><span class="n">hvals</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">ntypes</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">hvals</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">ntypes</span><span class="p">[</span><span class="n">hvals</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s">&#39;s&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># Read box information next</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">box</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">nitems</span><span class="p">,</span> <span class="n">ntypes</span><span class="p">,</span> <span class="n">box</span>

</div>
<span class="k">class</span> <span class="nc">LAMMPSAtom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;chainid&quot;</span><span class="p">,</span> <span class="s">&quot;charge&quot;</span><span class="p">,</span> <span class="s">&quot;mass&quot;</span><span class="p">,</span> <span class="s">&quot;_positions&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chainid</span> <span class="o">=</span> <span class="n">chain_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;LAMMPSAtom &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;: name &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; of chain &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chainid</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">index</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&#39;pos&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">LAMMPSAtom</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chainid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>


<div class="viewcode-block" id="LAMMPSDataConverter"><a class="viewcode-back" href="../../../documentation_pages/topology/LAMMPSParser.html#MDAnalysis.topology.LAMMPSParser.LAMMPSDataConverter">[docs]</a><span class="k">class</span> <span class="nc">LAMMPSDataConverter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to parse a LAMMPS_ DATA file and convert it to PSF/PDB.</span>

<span class="sd">    The DATA file contains both topology and coordinate information.</span>

<span class="sd">    The :class:`LAMMPSDataConverter` class can extract topology information and</span>
<span class="sd">    coordinates from a LAMMPS_ data file. For instance, in order to</span>
<span class="sd">    produce a PSF file of the topology and a PDB file of the coordinates</span>
<span class="sd">    from a data file &quot;lammps.data&quot; you can use::</span>

<span class="sd">      from MDAnalysis.topology.LAMMPSParser import LAMPPSData</span>
<span class="sd">      d = LAMMPSDataConverter(&quot;lammps.data&quot;)</span>
<span class="sd">      d.writePSF(&quot;lammps.psf&quot;)</span>
<span class="sd">      d.writePDB(&quot;lammps.pdb&quot;)</span>

<span class="sd">    You can then read a trajectory (e.g. a LAMMPS DCD, see</span>
<span class="sd">    :class:`MDAnalysis.coordinates.LAMMPS.DCDReader`) with ::</span>

<span class="sd">      u = MDAnalysis.Unverse(&quot;lammps.psf&quot;, &quot;lammps.dcd&quot;, format=&quot;LAMMPS&quot;)</span>

<span class="sd">    .. deprecated:: 0.9.0</span>

<span class="sd">    .. versionchanged:: 0.9.0</span>
<span class="sd">       Renamed from ``LAMMPSData`` to ``LAMMPSDataConverter``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header_keywords</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&quot;atoms&quot;</span><span class="p">,</span> <span class="s">&quot;bonds&quot;</span><span class="p">,</span> <span class="s">&quot;angles&quot;</span><span class="p">,</span> <span class="s">&quot;dihedrals&quot;</span><span class="p">,</span> <span class="s">&quot;impropers&quot;</span><span class="p">,</span>
        <span class="s">&quot;atom types&quot;</span><span class="p">,</span> <span class="s">&quot;bond types&quot;</span><span class="p">,</span> <span class="s">&quot;angle types&quot;</span><span class="p">,</span>
        <span class="s">&quot;dihedral types&quot;</span><span class="p">,</span> <span class="s">&quot;improper types&quot;</span><span class="p">,</span>
        <span class="s">&quot;xlo xhi&quot;</span><span class="p">,</span> <span class="s">&quot;ylo yhi&quot;</span><span class="p">,</span> <span class="s">&quot;zlo zhi&quot;</span><span class="p">]</span>

    <span class="n">connections</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
        <span class="p">[</span><span class="s">&quot;Bonds&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;bonds&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Angles&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;angles&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Dihedrals&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;dihedrals&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Impropers&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;impropers&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]])</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
        <span class="p">[</span><span class="s">&quot;Masses&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;atom types&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Velocities&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;atoms&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Pair Coeffs&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;atom types&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Bond Coeffs&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;bond types&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Angle Coeffs&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;angle types&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Dihedral Coeffs&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;dihedral types&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
        <span class="p">[</span><span class="s">&quot;Improper Coeffs&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;improper types&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;LAMMPS data file&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Open and check validity</span>
            <span class="k">with</span> <span class="n">openany</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">file_iter</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">xreadlines</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="c"># Parse headers</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">file_iter</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_keywords</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;xlo xhi&quot;</span><span class="p">,</span> <span class="s">&quot;ylo yhi&quot;</span><span class="p">,</span> <span class="s">&quot;zlo zhi&quot;</span><span class="p">):</span>
                                <span class="n">headers</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">headers</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">found</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                        <span class="k">break</span>

            <span class="c"># Parse sections</span>
            <span class="c"># XXX This is a crappy way to do it</span>
            <span class="k">with</span> <span class="n">openany</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">file_iter</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">xreadlines</span><span class="p">()</span>
                <span class="c"># Create coordinate array</span>
                <span class="n">positions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;atoms&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">file_iter</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span><span class="p">:</span>
                        <span class="n">h</span><span class="p">,</span> <span class="n">numcoeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                        <span class="c"># skip line</span>
                        <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="n">h</span><span class="p">]):</span>
                            <span class="n">fields</span> <span class="o">=</span> <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">conv_float</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
                        <span class="n">sections</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="k">elif</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
                        <span class="n">h</span><span class="p">,</span> <span class="n">numfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                        <span class="c"># skip line</span>
                        <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="n">h</span><span class="p">]):</span>
                            <span class="n">fields</span> <span class="o">=</span> <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
                        <span class="n">sections</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="k">elif</span> <span class="n">line</span> <span class="o">==</span> <span class="s">&quot;Atoms&quot;</span><span class="p">:</span>
                        <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;atoms&quot;</span><span class="p">]):</span>
                            <span class="n">fields</span> <span class="o">=</span> <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="n">LAMMPSAtom</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">chain_id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                           <span class="n">charge</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">_positions</span> <span class="o">=</span> <span class="n">positions</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                            <span class="n">positions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>
                        <span class="n">sections</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="k">elif</span> <span class="n">line</span> <span class="o">==</span> <span class="s">&quot;Masses&quot;</span><span class="p">:</span>
                        <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;atom type&quot;</span><span class="p">]):</span>
                            <span class="n">fields</span> <span class="o">=</span> <span class="n">file_iter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="k">print</span> <span class="s">&quot;help&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span>

<div class="viewcode-block" id="LAMMPSDataConverter.writePSF"><a class="viewcode-back" href="../../../documentation_pages/topology/LAMMPSParser.html#MDAnalysis.topology.LAMMPSParser.LAMMPSDataConverter.writePSF">[docs]</a>    <span class="k">def</span> <span class="nf">writePSF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export topology information to a simple PSF file.&quot;&quot;&quot;</span>
        <span class="c"># Naveen formatted -- works with MDAnalysis verison 52</span>
        <span class="c">#psf_atom_format = &quot;   %5d %-4s %-4d %-4s %-4s %-4s %10.6f      %7.4f            %1d\n&quot;</span>
        <span class="c"># Liz formatted -- works with MDAnalysis verison 59</span>
        <span class="c">#psf_atom_format = &quot;%8d %4.4s %-4.4s %-4.4s %-4.4s %-4.4s %16.8e %1s %-7.4f %7.7s %s\n&quot;</span>
        <span class="c"># Oli formatted -- works with MDAnalysis verison 81</span>
        <span class="n">psf_atom_format</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%8d</span><span class="s"> </span><span class="si">%4s</span><span class="s"> </span><span class="si">%-4s</span><span class="s"> </span><span class="si">%4s</span><span class="s"> </span><span class="si">%-4s% 4s</span><span class="s"> </span><span class="si">%-14.6f%-14.6f%8s</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">with</span> <span class="n">openany</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;PSF</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; !NTITLE</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&quot;Atoms&quot;</span><span class="p">])),</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; !NATOM</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="c">#print self.sections[&quot;Masses&quot;]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&quot;Atoms&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">resname</span><span class="p">,</span> <span class="n">atomname</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">resname</span><span class="p">,</span> <span class="n">atomname</span> <span class="o">=</span> <span class="s">&#39;TEMP&#39;</span><span class="p">,</span> <span class="s">&#39;XXXX&#39;</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">liz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&quot;Masses&quot;</span><span class="p">]):</span>
                    <span class="n">liz</span> <span class="o">=</span> <span class="n">liz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c">#print j+1, atom.type, liz</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">atom</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;TEMP&#39;</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">chainid</span><span class="p">),</span> <span class="n">resname</span><span class="p">,</span> <span class="n">atomname</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">type</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">atom</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">liz</span><span class="p">),</span> <span class="mf">0.</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="c">#print line</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">psf_atom_format</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">num_bonds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&quot;Bonds&quot;</span><span class="p">])</span>
            <span class="n">bond_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&quot;Bonds&quot;</span><span class="p">]</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num_bonds</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; !NBOND</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_bonds</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">bonds</span> <span class="o">=</span> <span class="n">bond_list</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">bonds</span> <span class="o">=</span> <span class="n">bond_list</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">bond_line</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bond</span><span class="p">:</span> <span class="n">string</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bond</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">8</span><span class="p">),</span> <span class="n">bonds</span><span class="p">)</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bond_line</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LAMMPSDataConverter.writePDB"><a class="viewcode-back" href="../../../documentation_pages/topology/LAMMPSParser.html#MDAnalysis.topology.LAMMPSParser.LAMMPSDataConverter.writePDB">[docs]</a>    <span class="k">def</span> <span class="nf">writePDB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export coordinates to a simple PDB file.&quot;&quot;&quot;</span>
        <span class="n">atom_format</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%6s%.5s</span><span class="s"> </span><span class="si">%4s</span><span class="s"> </span><span class="si">%4s</span><span class="s"> </span><span class="si">%.4s</span><span class="s">    </span><span class="si">%8.3f%8.3f%8.3f%6.2f%6.2f</span><span class="s">          </span><span class="si">%2s</span><span class="s">  </span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span>
        <span class="k">with</span> <span class="n">openany</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="s">&quot;Atoms&quot;</span><span class="p">]):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s">&quot;ATOM  &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&#39;XXXX&#39;</span><span class="p">,</span> <span class="s">&#39;TEMP&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">type</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">type</span><span class="p">)]</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">atom_format</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="p">))</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MDAnalysis 0.10.0-dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../MDAnalysis.html" >MDAnalysis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2005-2015, Naveen Michaud-Agrawal, Elizabeth J. Denning, Joshua Adelman,
    Christian Beckstein (logo), Alejandro Bernardin, Sébastien Buchoux,
    David Caplan, Matthieu Chavent, Xavier Deupi, Jan Domański, David L. Dotson
    Lennard van der Feltz, Philip Fowler, Joseph Goose, Richard J. Gowers, Lukas Grossar,
    Benjamin Hall, Joe Jordan, Jinju Lu, Robert McGibbon, Alex Nesterenko,
    Manuel Nuno Melo, Caio S. Souza, Danny Parton, Joshua L. Phillips, Tyler Reddy,
    Paul Rigor, Sean L. Seyler, Andy Somogyi, Lukas Stelzl, Zhuyi Xue,
    and Oliver Beckstein.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>