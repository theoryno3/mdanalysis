

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MDAnalysis.analysis.hole &mdash; MDAnalysis 0.10.0-dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.10.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.10.0-dev documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
    <link rel="top" title="MDAnalysis 0.10.0-dev documentation" href="../../../index.html" />
    <link rel="up" title="MDAnalysis" href="../../MDAnalysis.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MDAnalysis 0.10.0-dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../MDAnalysis.html" accesskey="U">MDAnalysis</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mdanalysis-logo-200x150.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MDAnalysis.analysis.hole</h1><div class="highlight"><pre>
<span class="c"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4 fileencoding=utf-8</span>
<span class="c">#</span>
<span class="c"># MDAnalysis --- http://www.MDAnalysis.org</span>
<span class="c"># Copyright (c) 2006-2015 Naveen Michaud-Agrawal, Elizabeth J. Denning, Oliver Beckstein</span>
<span class="c"># and contributors (see AUTHORS for the full list)</span>
<span class="c">#</span>
<span class="c"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c">#</span>
<span class="c"># Please cite your use of MDAnalysis in published work:</span>
<span class="c">#</span>
<span class="c"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generation and Analysis of HOLE pore profiles --- :mod:`MDAnalysis.analysis.hole`</span>
<span class="sd">=================================================================================</span>

<span class="sd">:Author: Lukas Stelzl, Oliver Beckstein</span>
<span class="sd">:Year: 2011-2012</span>
<span class="sd">:Copyright: GNU Public License v2</span>

<span class="sd">With the help of this module, HOLE_ can be run on frames in a trajectory. Data</span>
<span class="sd">can be combined and analyzed. HOLE_ [Smart1993]_ [Smart1996]_ must be installed</span>
<span class="sd">separately.</span>


<span class="sd">.. rubric:: References</span>

<span class="sd">.. [Smart1993] O.S. Smart, J.M. Goodfellow and B.A. Wallace.</span>
<span class="sd">               The Pore Dimensions of Gramicidin A. Biophysical Journal 65:2455-2460, 1993.</span>
<span class="sd">.. [Smart1996] O.S. Smart, J.G. Neduvelil, X. Wang, B.A. Wallace, and M.S.P. Sansom.</span>
<span class="sd">               HOLE: A program for the analysis of the pore dimensions of ion channel</span>
<span class="sd">               structural models. J.Mol.Graph., 14:354–360, 1996.</span>
<span class="sd">               URL http://hole.biop.ox.ac.uk/hole.</span>

<span class="sd">.. _HOLE: http://hole.biop.ox.ac.uk/hole</span>


<span class="sd">Examples</span>
<span class="sd">--------</span>

<span class="sd">Single structure</span>
<span class="sd">~~~~~~~~~~~~~~~~</span>

<span class="sd">Gramicidin A (gA) channel::</span>

<span class="sd">   from MDAnalysis.analysis.hole import HOLE, HOLEtraj</span>
<span class="sd">   from MDAnalysis.tests.datafiles import PDB_HOLE</span>

<span class="sd">   H = HOLE(PDB_HOLE, executable=&quot;~/hole2/bin/hole&quot;)  # set path to your hole binary</span>
<span class="sd">   H.run()</span>
<span class="sd">   H.collect()</span>
<span class="sd">   H.plot(linewidth=3, color=&quot;black&quot;, label=False)</span>


<span class="sd">Trajectory</span>
<span class="sd">~~~~~~~~~~</span>

<span class="sd">Analyzing a trajectory::</span>

<span class="sd">  u = MDAnalysis.Universe(psf, trajectory)</span>
<span class="sd">  H = HOLEtraj(u, ...)</span>
<span class="sd">  H.run()</span>
<span class="sd">  H.plot3D()</span>

<span class="sd">The profiles are available as the attribute :attr:`HOLEtraj.profiles`</span>
<span class="sd">(``H.profiles`` in the example) and are indexed by frame number but</span>
<span class="sd">can also be indexed by an arbitrary order parameter as shown in the</span>
<span class="sd">next example.</span>


<span class="sd">Trajectory with RMSD as order parameter</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">In order to classify the HOLE profiles the RMSD to a reference</span>
<span class="sd">structure is calculated for each trajectory frame (e.g. using the</span>
<span class="sd">:class:`MDAnalysis.analysis.rms.RMSD` analysis class). Then the HOLE</span>
<span class="sd">profiles can be ordered by the RMSD, which acts as an order</span>
<span class="sd">parameter. ::</span>

<span class="sd">  import MDAnalysis.analysis.hole</span>
<span class="sd">  import MDAnalysis.analysis.rms</span>
<span class="sd">  MDAnalysis.start_logging()</span>
<span class="sd">  ref = MDAnalysis.Universe(&quot;ref.psf&quot;, &quot;ref.pdb&quot;)         # reference structure</span>
<span class="sd">  u = MDAnalysis.Universe(&quot;ref.psf&quot;, &quot;traj.xtc&quot;)          # trajectory</span>

<span class="sd">  # calculate RMSD</span>
<span class="sd">  R = MDAnalysis.analysis.rms.RMSD(u, reference=ref, select=&quot;protein&quot;, mass_weighted=True)</span>
<span class="sd">  R.run()</span>

<span class="sd">  # HOLE analysis with order parameters</span>
<span class="sd">  H = MDAnalysis.analysis.hole.HOLEtraj(u, cvect=[0,0,1], orderparameters=R.rmsd[:,2])</span>
<span class="sd">  H.run()</span>

<span class="sd">The :attr:`HOLEtraj.profiles` dictionary will have the order parameter as key</span>
<span class="sd">for each frame. The plot functions will automatically sort the profiles by</span>
<span class="sd">ascending order parameter. To access the individual profiles one can simply</span>
<span class="sd">iterate over the sorted profiles (see :meth:`HOLEtraj.sorted_profiles_iter`) ::</span>

<span class="sd">  for q, profile in H:</span>
<span class="sd">     print &quot;orderparameter = %g&quot; % q</span>
<span class="sd">     print &quot;min(R) = %g&quot; % profile.radius.min()</span>


<span class="sd">Data structures</span>
<span class="sd">---------------</span>

<span class="sd">A profile is stored as a :class:`numpy.recarray`::</span>

<span class="sd">   frame   rxncoord   radius</span>

<span class="sd">frame</span>
<span class="sd">   integer frame number (only important when HOLE itself reads a</span>
<span class="sd">   trajectory)</span>
<span class="sd">rxncoord</span>
<span class="sd">   the distance along the pore axis, in Å</span>
<span class="sd">radius</span>
<span class="sd">   the pore radius, in Å</span>

<span class="sd">The :attr:`HOLE.profiles` or :attr:`HOLEtraj.profiles` dictionary</span>
<span class="sd">holds one profile for each key. By default the keys are the frame</span>
<span class="sd">numbers but :class:`HOLEtraj` can take the optional *orderparameters*</span>
<span class="sd">keyword argument and load an arbitrary order parameter for each</span>
<span class="sd">frame. In that case, the key becomes the orderparameter.</span>

<span class="sd">.. Note::</span>
<span class="sd">   The profiles dict is not ordered and hence one typically needs to manually</span>
<span class="sd">   order the keys first. Furthermore, duplicate keys are not possible:</span>
<span class="sd">   In the case of *duplicate orderparameters*, the last one read will</span>
<span class="sd">   be stored in the dict.</span>



<span class="sd">Analysis</span>
<span class="sd">--------</span>

<span class="sd">.. autoclass:: HOLE</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">   .. attribute:: profiles</span>

<span class="sd">      After running :meth:`HOLE.collect`, this dict contains all the</span>
<span class="sd">      HOLE profiles, indexed by the frame number. If only a single</span>
<span class="sd">      frame was analyzed then this will be ``HOLE.profiles[0]``. Note</span>
<span class="sd">      that the order is random; one needs to sort the keys first.</span>

<span class="sd">.. autoclass:: HOLEtraj</span>
<span class="sd">   :members:</span>
<span class="sd">   :inherited-members:</span>

<span class="sd">   .. attribute:: profiles</span>

<span class="sd">      After running :meth:`HOLE.collect`, this dict contains all the</span>
<span class="sd">      HOLE profiles, indexed by the frame number or the order</span>
<span class="sd">      parameter (if *orderparameters* was supplied). Note that the</span>
<span class="sd">      order is random; one needs to sort the keys first.</span>

<span class="sd">.. autodata:: SIMPLE2_RAD</span>


<span class="sd">Utilities</span>
<span class="sd">---------</span>

<span class="sd">.. autofunction:: write_simplerad2</span>
<span class="sd">.. autofunction:: seq2str</span>
<span class="sd">.. autoclass:: ApplicationError</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">from</span> <span class="nn">MDAnalysis</span> <span class="kn">import</span> <span class="n">ApplicationError</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.core.util</span> <span class="kn">import</span> <span class="n">which</span><span class="p">,</span> <span class="n">realpath</span><span class="p">,</span> <span class="n">asiterable</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;MDAnalysis.analysis.hole&quot;</span><span class="p">)</span>

<span class="c">#: Built-in HOLE radii (based on ``simple.rad`` from the HOLE_ distribution):</span>
<span class="c">#: van der Waals radii are AMBER united atom from Weiner et al. (1984), JACS, vol 106 pp765-768.</span>
<span class="c">#: *Simple* - Only use one value for each element C O H etc.</span>
<span class="c">#: Added radii for K+, NA+, CL- (Pauling hydration radius from Hille 2002).</span>
<span class="c">#: The data file can be written with the convenience function :func:`write_simplerad2`.</span>
<span class="n">SIMPLE2_RAD</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">remark: Time-stamp: &lt;2005-11-21 13:57:55 oliver&gt; [OB]</span>
<span class="s">remark: van der Waals radii: AMBER united atom</span>
<span class="s">remark: from Weiner et al. (1984), JACS, vol 106 pp765-768</span>
<span class="s">remark: Simple - Only use one value for each element C O H etc.</span>
<span class="s">remark: van der Waals radii</span>
<span class="s">remark: general last</span>
<span class="s">VDWR C??? ??? 1.85</span>
<span class="s">VDWR O??? ??? 1.65</span>
<span class="s">VDWR S??? ??? 2.00</span>
<span class="s">VDWR N??? ??? 1.75</span>
<span class="s">VDWR H??? ??? 1.00</span>
<span class="s">VDWR H?   ??? 1.00</span>
<span class="s">VDWR P??? ??? 2.10</span>
<span class="s">remark: ASN, GLN polar H (odd names for these atoms in xplor)</span>
<span class="s">VDWR E2?  GLN 1.00</span>
<span class="s">VDWR D2?  ASN 1.00</span>
<span class="s">remark: amber lone pairs on sulphurs</span>
<span class="s">VDWR LP?? ??? 0.00</span>
<span class="s">remark: for some funny reason it wants radius for K even though</span>
<span class="s">remark: it is on the exclude list</span>
<span class="s">remark: Use Pauling hydration radius (Hille 2001) [OB]</span>
<span class="s">VDWR K?   ??? 1.33</span>
<span class="s">VDWR NA?  ??? 0.95</span>
<span class="s">VDWR CL?  ??? 1.81</span>
<span class="s">remark: funny hydrogens in gA structure [OB]</span>
<span class="s">VDWR 1H?  ??? 1.00</span>
<span class="s">VDWR 2H?  ??? 1.00</span>
<span class="s">VDWR 3H?  ??? 1.00</span>
<span class="s">remark: need bond rad for molqpt option</span>
<span class="s">BOND C??? 0.85</span>
<span class="s">BOND N??? 0.75</span>
<span class="s">BOND O??? 0.7</span>
<span class="s">BOND S??? 1.1</span>
<span class="s">BOND H??? 0.5</span>
<span class="s">BOND P??? 1.0</span>
<span class="s">BOND ???? 0.85</span>
<span class="s">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="write_simplerad2"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.write_simplerad2">[docs]</a><span class="k">def</span> <span class="nf">write_simplerad2</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;simple2.rad&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write the built-in radii in :data:`SIMPLE2_RAD` to *filename*.</span>

<span class="sd">    Does nothing if *filename* already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rad</span><span class="p">:</span>
            <span class="n">rad</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SIMPLE2_RAD</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Created simple radii file </span><span class="si">%(filename)r</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">filename</span>

</div>
<div class="viewcode-block" id="seq2str"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.seq2str">[docs]</a><span class="k">def</span> <span class="nf">seq2str</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return sequence *v* as a string of numbers with spaces as separators.</span>

<span class="sd">    In the special case of ``None``, the empty string &quot;&quot; is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span>

</div>
<span class="k">class</span> <span class="nc">BaseHOLE</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Baseclass for HOLE analysis, providing plotting and utility functions&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&quot;hole.pickle&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save :attr:`profiles` as a Python pickle file *filename*.</span>

<span class="sd">        Load profiles dictionary with ::</span>

<span class="sd">           import cPickle</span>
<span class="sd">           profiles = cPickle.load(open(filename))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">cPickle</span>

        <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">),</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_plot_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.colors</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>

        <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;frames&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frames</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">keys</span><span class="p">()[::</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="n">asiterable</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;frames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frames</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;yshift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;yshift&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;rmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;rmax&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;_nolegend_&quot;</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;cmap&#39;</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
            <span class="n">normalize</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">asiterable</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="n">kw</span><span class="p">[</span><span class="s">&#39;linestyles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">asiterable</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;linestyle&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">kw</span><span class="p">,</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot profiles in a 1D graph.</span>

<span class="sd">        Lines are coloured according to the colour map *cmap*.</span>

<span class="sd">        :Keywords:</span>
<span class="sd">           *step*</span>
<span class="sd">              only plot every *step* profile [1]</span>
<span class="sd">           *cmap*</span>
<span class="sd">              matplotlib color map to continuously color graphs [jet]</span>
<span class="sd">           *color*</span>
<span class="sd">              color or iterable of colors to specify graph colors;</span>
<span class="sd">              ``None`` will use *cmap* instead [``None``]</span>
<span class="sd">           *linestyle*</span>
<span class="sd">              linestyle supported by :func:`matplotlib.pyplot.plot`;</span>
<span class="sd">              an iterable will be applied in turn [&#39;-&#39;]</span>
<span class="sd">           *yshift*</span>
<span class="sd">              displace each R(zeta) profile by *yshift* in the</span>
<span class="sd">              y-direction [0]</span>
<span class="sd">           *frames*</span>
<span class="sd">              integer or list: only plot these specific frame(s);</span>
<span class="sd">              the default is to plot everything (see also *step*).</span>
<span class="sd">              [``None``]</span>
<span class="sd">           *label*</span>
<span class="sd">              ignored and replaced with the frame number; if it</span>
<span class="sd">              is set to &quot;_nolegend_&quot; or ``False`` then no</span>
<span class="sd">              legend is displayed</span>
<span class="sd">           *ax*</span>
<span class="sd">              :class:`matplotlib.axes.Axes` instance to plot into</span>
<span class="sd">              [``None``]</span>

<span class="sd">        All other *kwargs* are passed to :func:`matplotlib.pyplot.plot`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span>

        <span class="n">kw</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_plot_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">iplot</span><span class="p">,</span> <span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">izip</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;frames&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;colors&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;linestyles&#39;</span><span class="p">])):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linestyle</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;zorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">frame</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">iplot</span> <span class="o">*</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;yshift&#39;</span><span class="p">]</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">rxncoord</span><span class="p">,</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c">#logger.debug(&quot;Plotted frame %d with color %r and linestyle %r&quot;, frame, color, linestyle)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&quot;pore coordinate $\zeta$ ($\AA$)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&quot;HOLE radius $r$ ($\AA$)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stacked graph of profiles.</span>

<span class="sd">        Lines are coloured according to the colour map *cmap*.</span>

<span class="sd">        :Keywords:</span>
<span class="sd">           *step*</span>
<span class="sd">              only plot every *step* profile [1]</span>
<span class="sd">           *cmap*</span>
<span class="sd">              matplotlib color map [jet]</span>
<span class="sd">           *rmax*</span>
<span class="sd">              only display radii up to *rmax* [``None``]</span>
<span class="sd">           *ylabel*</span>
<span class="sd">              label of the reaction coordinate axis [&quot;frames&quot;]</span>

<span class="sd">        Based on Stack Overflow post `3d plots using matplotlib`_.</span>

<span class="sd">        .. _`3d plots using matplotlib`:</span>
<span class="sd">           http://stackoverflow.com/questions/9053255/3d-plots-using-matplotlib</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="kn">import</span> <span class="nn">mpl_toolkits.mplot3d.axes3d</span> <span class="kn">as</span> <span class="nn">axes3d</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span>

        <span class="n">kw</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_plot_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;rmax&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s">&quot;frames&quot;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;figsize&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">&#39;3d&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;frames&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;colors&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;linestyles&#39;</span><span class="p">]):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linestyle</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;zorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">frame</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rmax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span>
                <span class="n">rxncoord</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rxncoord</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># does not seem to work with masked arrays but with nan hack!</span>
                <span class="c"># http://stackoverflow.com/questions/4913306/python-matplotlib-mplot3d-how-do-i-set-a-maximum-value</span>
                <span class="c"># -for-the-z-axis</span>
                <span class="c">#radius = numpy.ma.masked_greater(profile.radius, rmax)</span>
                <span class="c">#rxncoord = numpy.ma.array(profile.rxncoord, mask=radius.mask)</span>
                <span class="n">rxncoord</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rxncoord</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">radius</span><span class="p">[</span><span class="n">radius</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rxncoord</span><span class="p">,</span> <span class="n">frame</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">rxncoord</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&quot;pore coordinate $z$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">r&quot;HOLE radius $r$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">min_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the minimum radius over all profiles as a function of q&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">profile</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">profile</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sorted_profiles_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over profiles sorted by frame/order parameter *q*.</span>

<span class="sd">        The iterator produces tuples ``(q, profile)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">q</span><span class="p">])</span>

    <span class="n">__iter__</span> <span class="o">=</span> <span class="n">sorted_profiles_iter</span>


<div class="viewcode-block" id="HOLE"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE">[docs]</a><span class="k">class</span> <span class="nc">HOLE</span><span class="p">(</span><span class="n">BaseHOLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run HOLE on a single frame or a DCD trajectory.</span>

<span class="sd">    Only a subset of all `HOLE control parameters`_ is supported and can be set</span>
<span class="sd">    with keyword arguments.</span>

<span class="sd">    HOLE (as a FORTRAN77 program) has a number of limitations when it comes to</span>
<span class="sd">    filename lengths (must be shorter than the empirically found</span>
<span class="sd">    :attr:`HOLE.HOLE_MAX_LENGTH`). This class tries to work around them by</span>
<span class="sd">    creating temporary symlinks to files when needed but this can still fail</span>
<span class="sd">    when permissions are not correctly set on the current directory.</span>

<span class="sd">    Running HOLE with the :class:`HOLE` class is a 3-step process:</span>

<span class="sd">     1. set up the class with all desired parameters</span>
<span class="sd">     2. run HOLE with :meth:`HOLE.run`</span>
<span class="sd">     3. collect the data from the output file with :meth:`HOLE.collect`</span>

<span class="sd">    The class also provides some simple plotting functions of the collected</span>
<span class="sd">    data such as :meth:`HOLE.plot` or :meth:`HOLE.plot3D`.</span>

<span class="sd">    .. versionadded:: 0.7.7</span>

<span class="sd">    .. _`HOLE control parameters`:</span>
<span class="sd">       http://d2o.bioch.ox.ac.uk:38080/doc/hole_d03.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#: Maximum number of characters in a filename (limitation of HOLE)</span>
    <span class="n">HOLE_MAX_LENGTH</span> <span class="o">=</span> <span class="mi">70</span>

    <span class="c">#: List of residues that are ignore by default. Can be changed with</span>
    <span class="c">#: the *ignore_residues* keyword.</span>
    <span class="n">default_ignore_residues</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;SOL&quot;</span><span class="p">,</span> <span class="s">&quot;WAT&quot;</span><span class="p">,</span> <span class="s">&quot;TIP&quot;</span><span class="p">,</span> <span class="s">&quot;HOH&quot;</span><span class="p">,</span> <span class="s">&quot;K  &quot;</span><span class="p">,</span> <span class="s">&quot;NA &quot;</span><span class="p">,</span> <span class="s">&quot;CL &quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up parameters to run HOLE_ on PDB *filename*.</span>

<span class="sd">        :Arguments:</span>

<span class="sd">          *filename*</span>

<span class="sd">               The *filename* is used as input for HOLE in the &quot;COORD&quot; card of</span>
<span class="sd">               the input file.  It specifies the name of a PDB co-ordinate file</span>
<span class="sd">               to be used. This must be in Brookhaven protein databank format</span>
<span class="sd">               or something closely approximating this. Both ATOM and HETATM</span>
<span class="sd">               records are read. Note that if water molecules or ions are</span>
<span class="sd">               present in the channel these can be ignored on read by the use</span>
<span class="sd">               of the *ignore_residues* keyword.</span>

<span class="sd">               **Wildcard pattern**. A new feature (in release 2.1 of HOLE) was</span>
<span class="sd">               the option to include a wild card (``*``) in the filename. e.g.,</span>
<span class="sd">               *filename* = `&quot;ab*.pdb&quot;` will apply hole to all files in the</span>
<span class="sd">               directory whose name starts with ``ab`` and ends with</span>
<span class="sd">               ``.pdb``. This is intended to aid the analysis of multiple</span>
<span class="sd">               copies of the same molecule - produced during molecular dynamics</span>
<span class="sd">               or other method. The hole procedure will be applied to each file</span>
<span class="sd">               in turn with the same setup conditions (initial point, sampling</span>
<span class="sd">               distance etc.). Graphics files will contain a combination of the</span>
<span class="sd">               individual runs, one after another. Note that the pdb files are</span>
<span class="sd">               read independently so that they need not have an identical</span>
<span class="sd">               number of atoms or atom order etc. (though they should be</span>
<span class="sd">               sufficiently similar for a HOLE run from identical starting</span>
<span class="sd">               conditions to be useful).</span>

<span class="sd">               .. SeeAlso::</span>

<span class="sd">                  An alternative way to load in multiple files is a direct read</span>
<span class="sd">                  from a CHARMM binary dynamics DCD coordinate file - using the</span>
<span class="sd">                  *dcd* keyword or use :class:`HOLEtraj`.</span>


<span class="sd">        :Keywords:</span>

<span class="sd">          *dcd*</span>
<span class="sd">               DCD trajectory (must be supplied together with a matching</span>
<span class="sd">               PDB file *filename*) and then HOLE runs its analysis on each frame.</span>

<span class="sd">               It does multiple HOLE runs on positions taken from a CHARMM binary</span>
<span class="sd">               dynamics format .DCD trajectory file. The *dcd* file must have</span>
<span class="sd">               exactly the same number of atoms in exactly the same order as</span>
<span class="sd">               the pdb file specified by *filename*. Note that if this option</span>
<span class="sd">               is used the pdb file is used as a template only - the</span>
<span class="sd">               coordinates are ignored. Note that structural parameters</span>
<span class="sd">               determined for each individual structure are written in a tagged</span>
<span class="sd">               format so that it is possible to extract the information from</span>
<span class="sd">               the text output file using a :program:`grep` command. The</span>
<span class="sd">               reading of the file can be controlled by the *step* keyword</span>
<span class="sd">               and/or setting :attr:`HOLE.dcd_iniskip` to the number of frames</span>
<span class="sd">               to be skipped initially.</span>

<span class="sd">               .. Note::</span>

<span class="sd">                  HOLE is very picky and does not read all DCD-like formats. If</span>
<span class="sd">                  in doubt, look into the *logfile* for error diagnostics.</span>

<span class="sd">                  At the moment, DCDs generated with MDAnalysis are not</span>
<span class="sd">                  accepted by HOLE — use :class:`HOLEtraj`, which works with</span>
<span class="sd">                  anything that MDAnalysis can read.</span>

<span class="sd">          *logfile*</span>

<span class="sd">               name of the file collecting HOLE&#39;s output (which can be parsed</span>
<span class="sd">               using :meth:`HOLE.collect` [&quot;hole.out&quot;]</span>

<span class="sd">          *sphpdb*</span>

<span class="sd">               name of the HOLE sph file, a PDB-like file containig the coordinates</span>
<span class="sd">               of the pore centers [&quot;hole.sph&quot;]</span>

<span class="sd">          *step*</span>

<span class="sd">               step size for going through the trajectory (skips *step* - 1</span>
<span class="sd">               frames) [1]</span>

<span class="sd">          *cpoint*</span>

<span class="sd">               coordinates of a point inside the pore, e.g. ``[12.3, 0.7,</span>
<span class="sd">               18.55]``. If ``None`` then HOLE&#39;s own simple search algorithm is</span>
<span class="sd">               used.</span>

<span class="sd">               This specifies a point which lies within the channel, for simple</span>
<span class="sd">               channels such as gramicidin results do not show great</span>
<span class="sd">               sensitivity to the exact point taken. An easy way to produce an</span>
<span class="sd">               initial point is to use molecular graphics to find two atoms</span>
<span class="sd">               which lie either side of the pore and to average their</span>
<span class="sd">               co-ordinates. Or if the channel structure contains water</span>
<span class="sd">               molecules or counter ions then take the coordinates of one of</span>
<span class="sd">               these (and use the *ignore_residues* keyword to ignore them in</span>
<span class="sd">               the pore radius calculation).</span>

<span class="sd">               If this card is not specified then HOLE now (from version 2.2)</span>
<span class="sd">               attempts to make a guess where the channel will be. The</span>
<span class="sd">               procedure assumes the channel is reasonably symmetric. The</span>
<span class="sd">               initial guess on cpoint will be the centroid of all alpha carbon</span>
<span class="sd">               atoms (name &#39;CA&#39; in pdb file). This is then refined by a crude</span>
<span class="sd">               grid search up to 5 Å from the original position. This procedure</span>
<span class="sd">               works most of the time but is clearly far from infallible —</span>
<span class="sd">               results should be careful checked (with molecular graphics) if</span>
<span class="sd">               it is used. [``None``]</span>

<span class="sd">          *cvect*</span>

<span class="sd">               Search direction, should be parallel to the pore axis,</span>
<span class="sd">               e.g. ``[0,0,1]`` for the z-axis.</span>

<span class="sd">               If this keyword is ``None`` then HOLE now attempts to make a</span>
<span class="sd">               guess where the channel will be. The procedure assumes the</span>
<span class="sd">               channel is reasonably symmetric. The guess will be either along</span>
<span class="sd">               the X axis (1,0,0), Y axis (0,1,0) or Z axis (0,0,1). If the</span>
<span class="sd">               structure is not aligned on one of these axis the results will</span>
<span class="sd">               clearly be approximate. If a guess is used then results should</span>
<span class="sd">               be carefully checked. [``None``]</span>

<span class="sd">          *sample*</span>
<span class="sd">               distance of sample points in Å</span>

<span class="sd">               Specifies the distance between the planes used in the HOLE</span>
<span class="sd">               procedure. The default value is 0.2 Å, this should be reasonable</span>
<span class="sd">               for most purposes. However, if you wish to visualize a very</span>
<span class="sd">               tight constriction then specify a smaller value.  [0.2]</span>

<span class="sd">          *dotden*</span>
<span class="sd">               density of facettes for generating a 3D pore representation</span>

<span class="sd">               This number controls the density of dots which will be used by</span>
<span class="sd">               the program. A sphere of dots is placed on each centre</span>
<span class="sd">               determined in the Monte Carlo procedure. Only dots which do not</span>
<span class="sd">               lie within any other sphere are considered. The actual number of</span>
<span class="sd">               dots written is therefore controlled by *dotden* and</span>
<span class="sd">               *sample*. *dotden* should be set to between 5 (few dots per</span>
<span class="sd">               sphere) and 35 (large number of dots per sphere). [15]</span>

<span class="sd">          *endrad*</span>
<span class="sd">               Radius which is considered to be the end of the pore. This</span>
<span class="sd">               keyword can be used to specify the radius above which the</span>
<span class="sd">               program regards a result as indicating that the end of the pore</span>
<span class="sd">               has been reached. The default value is 22.0 Å. This may need to</span>
<span class="sd">               be increased for large channels or reduced for small. [22.0]</span>

<span class="sd">          *shorto*</span>

<span class="sd">               Determines the output of output in the *logfile*; for automated processing</span>
<span class="sd">               this must be &lt; 3.</span>

<span class="sd">               - 0: Full text output</span>
<span class="sd">               - 1: All text output given except &quot;run in progress&quot; (i.e.,</span>
<span class="sd">                 detailed contemporary description of what HOLE is doing).</span>
<span class="sd">               - 2: Ditto plus no graph type output - only leaving minimum</span>
<span class="sd">                 radius and conductance calculations.</span>
<span class="sd">               - 3: All text output other than input card mirroring and error messages</span>
<span class="sd">                 turned off.</span>

<span class="sd">          *ignore_residues*</span>

<span class="sd">               sequence of three-letter residues that are not taken into account during the</span>
<span class="sd">               calculation; wildcards are *not* supported</span>
<span class="sd">               [ ``[&quot;SOL&quot;,&quot;WAT&quot;, &quot;TIP&quot;, &quot;HOH&quot;, &quot;K  &quot;, &quot;NA &quot;, &quot;CL &quot;]`` ]</span>

<span class="sd">          *radius*</span>
<span class="sd">               Path to the radii; if set to None then a set of default radii, :data:`SIMPLE2_RAD`,</span>
<span class="sd">               is used (an extension of ``simple.rad`` from the HOLE distribution)</span>

<span class="sd">               This specifies the name for the file specifying van der Waals</span>
<span class="sd">               radii for each atom. A number of files with different values are</span>
<span class="sd">               supplied with HOLE.</span>

<span class="sd">          *sphpdb*</span>

<span class="sd">               This keyword specifies the filename for output of the sphere</span>
<span class="sd">               centre information in pdb form. Its typical suffix is</span>
<span class="sd">               &quot;.sph&quot;. The co-ordinates are set to the sphere centres and the</span>
<span class="sd">               occupancies are the sphere radii. All centres are assigned the</span>
<span class="sd">               atom name QSS and residue name SPH and the residue number is set</span>
<span class="sd">               to the storage number of the centre. The file can be imported</span>
<span class="sd">               into molecular graphics programs but are likely to be bonded</span>
<span class="sd">               together in a awful manner - as the points are very close to one</span>
<span class="sd">               another. In VMD sph objects are best displayed as</span>
<span class="sd">               &quot;Points&quot;. Displaying .sph objects rather than rendered or dot</span>
<span class="sd">               surfaces can be useful to analyze the distance of particular</span>
<span class="sd">               atoms from the sphere-centre line.</span>

<span class="sd">               Most usefully .sph files can be used to produce molecular</span>
<span class="sd">               graphical output from a hole run. This is achieved by using the</span>
<span class="sd">               :program:`sph_process` program to read the .sph</span>
<span class="sd">               file. [&quot;hole.sph&quot;]</span>

<span class="sd">          *executable*</span>

<span class="sd">               Path to the :program:`hole` executable</span>
<span class="sd">               (e.g. ``/opt/hole/exe/hole``); the other programs</span>
<span class="sd">               :program:`sph_process` and :program:`sos_triangle` are assumed</span>
<span class="sd">               to live in the same directory as :program:`hole`. If</span>
<span class="sd">               :program:`hole` is found on the :envvar:`PATH` then the bare</span>
<span class="sd">               executable name is sufficient.  [&quot;hole&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># list of temporary files, to be cleaned up on __del__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_fix_long_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;dcd&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_fix_long_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;step&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c"># HOLE docs description is confusing: step or skip??</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcd_iniskip</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;cpoint&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;cvect&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;sample&quot;</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dotden</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;dotden&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endrad</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;endrad&quot;</span><span class="p">,</span> <span class="mf">22.</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shorto</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;shorto&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c"># look at using SHORTO 2 for minimum output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_residues</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;ignore_residues&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_ignore_residues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_fix_long_filename</span><span class="p">(</span>
            <span class="n">realpath</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;radius&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">write_simplerad2</span><span class="p">()))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Setting up HOLE analysis for </span><span class="si">%(filename)r</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Using radius file </span><span class="si">%(radius)r</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># guess executables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hole_exe_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;executable&#39;</span><span class="p">,</span> <span class="s">&#39;hole&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;hole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">hole_exe_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;hole&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s">&quot;HOLE binary </span><span class="si">%(hole_exe_name)r</span><span class="s"> not found.&quot;</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%(hole_exe_name)r</span><span class="s"> must be on the PATH or provided as keyword argument &#39;executable&#39;.&quot;</span><span class="p">,</span>
                         <span class="nb">vars</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">)</span>
        <span class="n">holepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;hole&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;sos_triangle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">holepath</span><span class="p">,</span> <span class="s">&quot;sos_triangle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;sph_process&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">holepath</span><span class="p">,</span> <span class="s">&quot;sph_process&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sphpdb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;sphpdb&quot;</span><span class="p">,</span> <span class="s">&quot;hole.sph&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;logfile&quot;</span><span class="p">,</span> <span class="s">&quot;hole.out&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            ! Input file for Oliver Smart&#39;s HOLE program</span>
<span class="s">            ! written by MDAnalysis.analysis.hole.HOLE</span>
<span class="s">            ! filename = </span><span class="si">%(filename)s</span><span class="s"></span>
<span class="s">            COORD  </span><span class="si">%(coordinates)s</span><span class="s"></span>
<span class="s">            RADIUS </span><span class="si">%(radius)s</span><span class="s"></span>
<span class="s">            SPHPDB </span><span class="si">%(sphpdb)s</span><span class="s"></span>
<span class="s">            SAMPLE </span><span class="si">%(sample)f</span><span class="s"></span>
<span class="s">            ENDRAD </span><span class="si">%(endrad)f</span><span class="s"></span>
<span class="s">            IGNORE </span><span class="si">%(ignore)s</span><span class="s"></span>
<span class="s">            SHORTO </span><span class="si">%(shorto)d</span><span class="s"></span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># note: if it is None then we can&#39;t change this with a kw for run() !!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">CPOINT </span><span class="si">%(cpoint_xyz)s</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;HOLE will guess CPOINT&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># note: if it is None then we can&#39;t change this with a kw for run() !!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">CVECT  </span><span class="si">%(cvect_xyz)s</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;HOLE will guess CVECT&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">:</span>
            <span class="c"># CHARMD -- DCD (matches COORD)</span>
            <span class="c"># CHARMS int int -- ignore_first_N_frames   skip_every_X_frames</span>
            <span class="c"># http://d2o.bioch.ox.ac.uk:38080/doc/hole_d03.html#CHARMD</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">CHARMD </span><span class="si">%(dcd)s</span><span class="se">\n</span><span class="s">CHARMS </span><span class="si">%(dcd_iniskip)d</span><span class="s"> </span><span class="si">%(dcd_step)d</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="c"># sanity checks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shorto</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;SHORTO (</span><span class="si">%d</span><span class="s">) needs to be &lt; 3 in order to extract a HOLE profile!&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">shorto</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">program</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">which</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Executable </span><span class="si">%(program)r</span><span class="s"> not found, should have been </span><span class="si">%(path)r</span><span class="s">.&quot;</span><span class="p">,</span>
                             <span class="nb">vars</span><span class="p">())</span>
        <span class="c"># results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="HOLE.check_and_fix_long_filename"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.check_and_fix_long_filename">[docs]</a>    <span class="k">def</span> <span class="nf">check_and_fix_long_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">tmpdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return *filename* suitable for HOLE.</span>

<span class="sd">        HOLE is limited to filenames &lt;= :attr:`HOLE.HOLE_MAX_LENGTH`. This method</span>

<span class="sd">        1. returns *filename* if HOLE can process it</span>
<span class="sd">        2. returns a relative path (see :func:`os.path.relpath`) if that shortens the</span>
<span class="sd">           path sufficiently</span>
<span class="sd">        3. creates a symlink to *filename* (:func:`os.symlink`) in a safe temporary</span>
<span class="sd">           directory and returns the path of the symlink. The temporary directory and</span>
<span class="sd">           the symlink are stored in :attr:`HOLE.tempfiles` and :attr:`HOLE.tempdirs`</span>
<span class="sd">           and deleted when the :class:`HOLE` instance is deleted or garbage collected.</span>

<span class="sd">           By default the temporary directory is created inside the current</span>
<span class="sd">           directory in order to keep that path name short. This can be changed</span>
<span class="sd">           with the *tmpdir* keyword (e.g. one can use &quot;/tmp&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filename</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;path check: HOLE will not read </span><span class="si">%r</span><span class="s"> because it has more than </span><span class="si">%d</span><span class="s"> characters.&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">)</span>
        <span class="c"># try a relative path</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;path check: Using relative path: </span><span class="si">%r</span><span class="s"> --&gt; </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">newname</span>

        <span class="c"># shorten path by creating a symlink inside a safe temp dir</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">HOLE_MAX_LENGTH</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;path check: Failed to shorten filename </span><span class="si">%r</span><span class="s"> --&gt; </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Failed to shorten filename </span><span class="si">%r</span><span class="s"> --&gt; </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;path check: Using symlink: </span><span class="si">%r</span><span class="s"> --&gt; </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newname</span>
</div>
<div class="viewcode-block" id="HOLE.run"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run HOLE on the input file.&quot;&quot;&quot;</span>
        <span class="n">inpname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;inpfile&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">outname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;outfile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="c"># NOTE: If cvect and cpoint had been None in the constructor then they are</span>
        <span class="c">#       ignored here. Arguably a bug... but then again, the keywords for run() are</span>
        <span class="c">#       not even officially documented :-).</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;cvect_xyz&quot;</span><span class="p">,</span> <span class="n">seq2str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;cvect&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvect</span><span class="p">)))</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;cpoint_xyz&quot;</span><span class="p">,</span> <span class="n">seq2str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;cpoint&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvect</span><span class="p">)))</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">seq2str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ignore_residues&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_residues</span><span class="p">)))</span>
        <span class="n">holeargs</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">holeargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">%</span> <span class="n">holeargs</span>
        <span class="k">if</span> <span class="n">inpname</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inpname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Wrote HOLE input file </span><span class="si">%r</span><span class="s"> for inspection&quot;</span><span class="p">,</span> <span class="n">inpname</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Starting HOLE on </span><span class="si">%(filename)r</span><span class="s"> (trajectory: </span><span class="si">%(dcd)r</span><span class="s">)&quot;</span><span class="p">,</span> <span class="n">holeargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> &lt;</span><span class="si">%s</span><span class="s"> &gt;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;hole&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">inpname</span> <span class="k">if</span> <span class="n">inpname</span> <span class="k">else</span> <span class="s">&quot;(input)&quot;</span><span class="p">),</span> <span class="n">outname</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">hole</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;hole&#39;</span><span class="p">]],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">hole</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="c"># HOLE is not very good at setting returncodes so check ourselves</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s">&#39;*** ERROR ***&#39;</span><span class="p">,</span> <span class="s">&#39;ERROR&#39;</span><span class="p">)):</span>
                    <span class="n">hole</span><span class="o">.</span><span class="n">returncode</span> <span class="o">=</span> <span class="mi">255</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">hole</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;HOLE Failure (</span><span class="si">%d</span><span class="s">). Check output </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">hole</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">outname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stderr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="n">hole</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s">&quot;HOLE </span><span class="si">%r</span><span class="s"> failed. Check output </span><span class="si">%r</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&#39;hole&#39;</span><span class="p">],</span> <span class="n">outname</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;HOLE finished: output file </span><span class="si">%(outname)r</span><span class="s">&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="HOLE.create_vmd_surface"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.create_vmd_surface">[docs]</a>    <span class="k">def</span> <span class="nf">create_vmd_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&quot;hole.vmd&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process HOLE output to create a smooth pore surface suitable for VMD.</span>

<span class="sd">        Takes the :attr:`sphpdb` file and feeds it to :program:`sph_process`</span>
<span class="sd">        and :program:`sos_triangle` as described under `Visualization of HOLE</span>
<span class="sd">        results`_.</span>

<span class="sd">        Load the output file *filename* into VMD by issuing in the tcl console ::</span>

<span class="sd">           source hole.vmd</span>

<span class="sd">        The level of detail is determined by :attr:`HOLE.dotden` (which can be</span>
<span class="sd">        overriden by keyword *dotden*).</span>

<span class="sd">        The surface will be colored so that parts that are inaccessible to</span>
<span class="sd">        water (pore radius &lt; 1.15 Å) are red, water accessible parts (1.15 Å &gt;</span>
<span class="sd">        pore radius &lt; 2.30 Å) are green and wide areas (pore radius &gt; 2.30 Å</span>
<span class="sd">        are blue).</span>

<span class="sd">        .. _`Visualization of HOLE results`: http://d2o.bioch.ox.ac.uk:38080/doc/hole_d04.html</span>
<span class="sd">        .. _`sph_process`: http://d2o.bioch.ox.ac.uk:38080/doc/hole_d04.html#sph_process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># not sure how this works when run on multiple frames...</span>
        <span class="c"># see http://d2o.bioch.ox.ac.uk:38080/doc/hole_d04.html#sph_process</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;dotden&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dotden</span><span class="p">)</span>

        <span class="n">fd</span><span class="p">,</span> <span class="n">tmp_sos</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s">&quot;.sos&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&quot;sph_process&quot;</span><span class="p">],</span> <span class="s">&quot;-sos&quot;</span><span class="p">,</span> <span class="s">&quot;-dotden&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dotden&#39;</span><span class="p">]),</span>
                <span class="s">&quot;-color&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphpdb</span><span class="p">,</span> <span class="n">tmp_sos</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;sph_process failed (</span><span class="si">%d</span><span class="s">)&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="s">&quot;sph_process failed&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span> <span class="k">as</span> <span class="n">sos</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">triangles</span><span class="p">:</span>
                    <span class="n">rc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">[</span><span class="s">&quot;sos_triangle&quot;</span><span class="p">],</span> <span class="s">&quot;-s&quot;</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">sos</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">triangles</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;sos_triangle failed (</span><span class="si">%d</span><span class="s">)&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="s">&quot;sos_triangle failed&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_sos</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">filename</span>
</div>
<div class="viewcode-block" id="HOLE.collect"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLE.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the output from a HOLE run into numpy recarrays.</span>

<span class="sd">        Can deal with outputs containing multiple frames. Output format::</span>

<span class="sd">            frame  rxncoord   radius</span>

<span class="sd">        The method saves the result as :attr:`HOLE.profiles`, a dictionary</span>
<span class="sd">        indexed by the frame number. Each entry is a</span>
<span class="sd">        :class:`numpy.recarray`.</span>

<span class="sd">        If the keyword *outdir* is supplied (e.g. &quot;.&quot;) then each profile is</span>
<span class="sd">        saved to a gzipped data file.</span>

<span class="sd">        :Keywords:</span>
<span class="sd">           *run*</span>
<span class="sd">              identifier, free form [1]</span>
<span class="sd">           *outdir*</span>
<span class="sd">              save output data under *outdir*/*run* if set to any other</span>
<span class="sd">              value but ``None`` [``None``]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">MDAnalysis.core.util</span> <span class="kn">import</span> <span class="n">FORTRANReader</span>
        <span class="c"># cenxyz.cvec      radius  cen_line_D sum{s/(area point sourc</span>
        <span class="c">#0123456789.0123456789.0123456789.0123456789.0123456789.0123456789.</span>
        <span class="c">#            11          22          33          44</span>
        <span class="c">#123456789.123456789.123456789.123456789.123456789.123456789.123456789.</span>
        <span class="c">#1           13</span>
        <span class="c"># 3F12</span>
        <span class="c">#   -27.17082    15.77469   -73.19195     0.00013   (sampled)</span>
        <span class="c">#   -27.07082    12.91103   -69.39840     0.00032 (mid-point)</span>
        <span class="c">#</span>
        <span class="c"># only parse cenxyz.cvec      radius  cen_line_D</span>
        <span class="c"># because the area can be ********</span>
        <span class="n">holeformat</span> <span class="o">=</span> <span class="n">FORTRANReader</span><span class="p">(</span><span class="s">&#39;3F12&#39;</span><span class="p">)</span>

        <span class="n">hole_output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;holeout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="n">run</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;run&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c"># id number</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;outdir&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Collecting HOLE profiles for run with id </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># length of trajectory --- is this really needed?? No... just for info</span>
        <span class="k">if</span> <span class="s">&#39;*&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">glob</span>

            <span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Glob pattern </span><span class="si">%r</span><span class="s"> did not find any files.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Glob pattern </span><span class="si">%r</span><span class="s"> did not find any files.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Found </span><span class="si">%d</span><span class="s"> input files based on glob pattern </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">MDAnalysis</span> <span class="kn">import</span> <span class="n">Universe</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">Universe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">numframes</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd_iniskip</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dcd_step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Found </span><span class="si">%d</span><span class="s"> input frames in DCD trajectory </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcd</span><span class="p">)</span>

        <span class="c"># one recarray for each frame, indexed by frame number</span>
        <span class="c"># TODO: use ordered dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Run </span><span class="si">%s</span><span class="s">: Reading </span><span class="si">%d</span><span class="s"> HOLE profiles from </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">hole_output</span><span class="p">)</span>
        <span class="n">hole_profile_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hole_output</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hole</span><span class="p">:</span>
            <span class="n">read_data</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">hole</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c"># preserve columns (FORTRAN output...)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot; Starting calculation for position number&quot;</span><span class="p">):</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">hole_profile_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Started reading profile </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">hole_profile_no</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot; cenxyz.cvec&quot;</span><span class="p">):</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Started reading data&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">read_data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rxncoord</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cenlineD</span> <span class="o">=</span> <span class="n">holeformat</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&quot;Run </span><span class="si">%d</span><span class="s">: Problem parsing line </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&quot;Check input file </span><span class="si">%r</span><span class="s">.&quot;</span><span class="p">,</span> <span class="n">hole_output</span><span class="p">)</span>
                            <span class="k">raise</span>
                        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hole_profile_no</span><span class="p">,</span> <span class="n">rxncoord</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># end of records (empty line)</span>
                        <span class="n">read_data</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="n">frame_hole_output</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromrecords</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s">&quot;i4,f8,f8&quot;</span><span class="p">,</span>
                                                                  <span class="n">names</span><span class="o">=</span><span class="s">&quot;frame,rxncoord,radius&quot;</span><span class="p">)</span>
                        <span class="c"># store the profile</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">[</span><span class="n">hole_profile_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_hole_output</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Collected HOLE profile for frame </span><span class="si">%d</span><span class="s"> (</span><span class="si">%d</span><span class="s"> datapoints)&quot;</span><span class="p">,</span>
                                     <span class="n">hole_profile_no</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_hole_output</span><span class="p">))</span>
                        <span class="c"># save a profile for each frame (for debugging and scripted processing)</span>
                        <span class="c"># a tmp folder for each trajectory</span>
                        <span class="k">if</span> <span class="n">outdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">rundir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s">&quot;run_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">))</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">rundir</span><span class="p">):</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">rundir</span><span class="p">)</span>
                            <span class="n">frame_hole_txt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rundir</span><span class="p">,</span> <span class="s">&quot;radii_</span><span class="si">%s</span><span class="s">_</span><span class="si">%04d</span><span class="s">.dat.gz&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">hole_profile_no</span><span class="p">))</span>
                            <span class="n">numpy</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">frame_hole_txt</span><span class="p">,</span> <span class="n">frame_hole_output</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Finished with frame </span><span class="si">%d</span><span class="s">, saved as </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">hole_profile_no</span><span class="p">,</span> <span class="n">frame_hole_txt</span><span class="p">)</span>
                        <span class="k">continue</span>
                        <span class="c"># if we get here then we haven&#39;t found anything interesting</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Collected HOLE radius profiles for </span><span class="si">%d</span><span class="s"> frames&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Missing data: Found </span><span class="si">%d</span><span class="s"> HOLE profiles from </span><span class="si">%d</span><span class="s"> frames.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profiles</span><span class="p">),</span> <span class="n">length</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempfiles</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempdirs</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="HOLEtraj"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj">[docs]</a><span class="k">class</span> <span class="nc">HOLEtraj</span><span class="p">(</span><span class="n">BaseHOLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Analyze all frames in a trajectory.</span>

<span class="sd">    The :class:`HOLE` class provides a direct interface to HOLE. HOLE itself</span>
<span class="sd">    has limited support for analysing trajectories but cannot deal with all the</span>
<span class="sd">    trajectory formats understood by MDAnalysis. This class can take any</span>
<span class="sd">    universe and feed it to HOLE. By default it sequentially creates a PDB for</span>
<span class="sd">    each frame and runs HOLE on the frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up the class.</span>

<span class="sd">        :Arguments:</span>

<span class="sd">          *universe*</span>
<span class="sd">               The input trajectory as part of a</span>
<span class="sd">               :class:`~MDAnalysis.core.AtomGroup.Universe`. trajectory is</span>
<span class="sd">               converted to a sequence of PDB files and HOLE is run on each</span>
<span class="sd">               individual file. (Use the *start*, *stop*, and *step* keywords</span>
<span class="sd">               to slice the trajectory.)</span>

<span class="sd">          *orderparameters*</span>
<span class="sd">               Sequence or text file with list of numbers corresponding to the</span>
<span class="sd">               frames in the trajectory.</span>

<span class="sd">          *start*, *stop*, *step*</span>
<span class="sd">               frame indices to slice the trajectory as</span>
<span class="sd">               ``universe.trajectory[start, stop, step]``</span>

<span class="sd">          *selection*</span>
<span class="sd">               selection string for :meth:`~MDAnalysis.core.AtomGroup.Universe.selectAtoms` to select</span>
<span class="sd">               the group of atoms that is to be analysed by HOLE [&quot;protein&quot;]</span>

<span class="sd">          *cpoint*</span>
<span class="sd">               Point inside the pore.</span>

<span class="sd">               If set to ``True`` then *cpoint* is guessed as the</span>
<span class="sd">               :meth:`~MDAnalysis.core.AtomGroup.AtomGroup.centerOfGeometry` of</span>
<span class="sd">               the *selection* from the first frame of the trajectory.</span>

<span class="sd">               If *cpoint* is not set or set to ``None`` then HOLE guesses it</span>
<span class="sd">               with its own algorithm (for each individual frame). [``None``]</span>

<span class="sd">          *kwargs*</span>
<span class="sd">               All other keywords are passed on to :class:`HOLE` (see there for description).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="o">=</span> <span class="n">universe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;selection&quot;</span><span class="p">,</span> <span class="s">&quot;protein&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderparametersfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;orderparameters&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;cpoint&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_cpoint</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Guessed CPOINT = </span><span class="si">%r</span><span class="s"> from selection </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;cpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpoint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hole_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="c"># processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderparameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_orderparameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderparametersfile</span><span class="p">)</span>

<div class="viewcode-block" id="HOLEtraj.guess_cpoint"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj.guess_cpoint">[docs]</a>    <span class="k">def</span> <span class="nf">guess_cpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guess a point inside the pore.</span>

<span class="sd">        This method simply uses the center of geometry of the protein selection</span>
<span class="sd">        as a guess. *selection* is &quot;protein&quot; by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">selectAtoms</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;selection&quot;</span><span class="p">,</span> <span class="s">&quot;protein&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">centerOfGeometry</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_process_orderparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read orderparameters from *data*</span>

<span class="sd">        * If *data* is a string: Read orderparameters from *filename*.</span>
<span class="sd">        * If data is a array/list: use as is</span>
<span class="sd">        * If ``None``: assign frame numbers from trajectory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># frame numbers</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">numframes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Order parameter array must be 1D.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">numframes</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s">&quot;Not same number of orderparameters ({0}) as trajectory frames ({1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">numframes</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>

<div class="viewcode-block" id="HOLEtraj.run"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run HOLE on the whole trajectory and collect profiles.</span>

<span class="sd">        Keyword arguments *start*, *stop*, and *step* can be used to only</span>
<span class="sd">        analyse part of the trajectory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;step&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
        <span class="n">hole_kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hole_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">hole_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">profiles</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># index by orderparameters: NOTE: can overwrite!</span>

        <span class="c"># better: if not a DCD, convert to DCD because HOLE can read it (does it need a PSF?)</span>
        <span class="c"># ... maybe faster than splittinginto PDBs...</span>
        <span class="c"># but currently HOLE chokes on MDAnalysis-generated DCDs (header comment wrong/too long?)</span>

        <span class="c"># probably slow (especially with additional linking for filename length) --</span>
        <span class="c"># can&#39;t we do this in memory?? Or at least check that we can get a local tmp dir</span>

        <span class="c"># TODO: alternatively, dump all frames with leading framenumber and use a wildcard</span>
        <span class="c">#       (although the file renaming might create problems...)</span>
        <span class="n">protein</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">selectAtoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderparameters</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">:</span><span class="n">step</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">:</span><span class="n">step</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;HOLE analysis frame </span><span class="si">%4d</span><span class="s"> (orderparameter </span><span class="si">%g</span><span class="s">)&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">pdbfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s">&quot;.pdb&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>  <span class="c"># only need an empty file that can be overwritten, close right away (Issue 129)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">protein</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
                <span class="n">hole_profiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_hole</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">hole_kw</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hole_profiles</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="s">&quot;Got {0} profiles ({1}) --- should be 1 (time step {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">hole_profiles</span><span class="p">),</span> <span class="n">hole_profiles</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ts</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
            <span class="n">profiles</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">hole_profiles</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiles</span> <span class="o">=</span> <span class="n">profiles</span>
</div>
<div class="viewcode-block" id="HOLEtraj.run_hole"><a class="viewcode-back" href="../../../documentation_pages/analysis/hole.html#MDAnalysis.analysis.hole.HOLEtraj.run_hole">[docs]</a>    <span class="k">def</span> <span class="nf">run_hole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run HOLE on a single PDB file *pdbfile*.&quot;&quot;&quot;</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">HOLE</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">H</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">H</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">H</span><span class="o">.</span><span class="n">profiles</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MDAnalysis 0.10.0-dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../MDAnalysis.html" >MDAnalysis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2005-2015, Naveen Michaud-Agrawal, Elizabeth J. Denning, Joshua Adelman,
    Christian Beckstein (logo), Alejandro Bernardin, Sébastien Buchoux,
    David Caplan, Matthieu Chavent, Xavier Deupi, Jan Domański, David L. Dotson
    Lennard van der Feltz, Philip Fowler, Joseph Goose, Richard J. Gowers, Lukas Grossar,
    Benjamin Hall, Joe Jordan, Jinju Lu, Robert McGibbon, Alex Nesterenko,
    Manuel Nuno Melo, Caio S. Souza, Danny Parton, Joshua L. Phillips, Tyler Reddy,
    Paul Rigor, Sean L. Seyler, Andy Somogyi, Lukas Stelzl, Zhuyi Xue,
    and Oliver Beckstein.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>